<!doctype html>
<html lang="cs">
  <head>
    <meta charset="utf-8" />
    <title>Agent USA ‚Äì mƒõstsk√© menu</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      :root {
        font-family: "Inter", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      }

      body {
        margin: 0;
        min-height: 100vh;
        background: #030617;
        color: #f8fafc;
      }

      .city-stage {
        position: relative;
        min-height: 100vh;
        overflow: hidden;
        background: radial-gradient(circle at top, #12223f 0%, #030712 65%, #01030a 100%);
        width: 100%;
        margin: 0 auto;
      }

      #canvasBlock {
        position: absolute;
        inset: 0;
        pointer-events: none;
      }

      .city-cover {
        position: relative;
        width: 100%;
        height: 100%;
      }

      #cityBackdrop {
        width: 100%;
        height: 100%;
        object-fit: cover;
        filter: saturate(1.15) contrast(0.95);
        position: relative;
        z-index: 2;
      }

      #skyGradient,
      #nightOverlay,
      #daySunOverlay {
        position: absolute;
        inset: 0;
        pointer-events: none;
      }

      #skyGradient {
        background: linear-gradient(180deg, #3f7fd8 0%, #8fcfff 55%, #f4fbff 100%);
        z-index: 1;
        opacity: 1;
      }

      #nightOverlay {
        background: rgba(2, 6, 23, 0.65);
        opacity: 0;
        transition: opacity 0.4s ease;
        z-index: 3;
      }

      #daySunOverlay {
        background: radial-gradient(circle at 20% 20%, rgba(255, 196, 124, 0.35), transparent 55%);
        opacity: 0;
        transition: opacity 0.4s ease;
        mix-blend-mode: screen;
        z-index: 3;
      }

      #gameCanvas {
        position: absolute;
        inset: 0;
        width: 100%;
        height: 100%;
        opacity: 0;
      }

      .ui-layer {
        position: relative;
        z-index: 10;
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        padding: 1rem 1rem 6.5rem;
      }

      .top-bar,
      .location-bar {
        backdrop-filter: blur(26px);
        background: rgba(2, 6, 23, 0.4);
        border: 1px solid rgba(148, 163, 184, 0.25);
        box-shadow: 0 25px 60px rgba(3, 6, 18, 0.35);
      }

      .top-bar {
        border-radius: 32px;
      }

      #currentTimeLabel {
        font-variant-numeric: tabular-nums;
        font-feature-settings: "tnum";
      }

      .location-bar {
        border-radius: 0;
        border-left: 0;
        border-right: 0;
        border-bottom: 0;
        min-height: 64px;
      }

      .level-circle {
        height: 56px;
        width: 56px;
        border-radius: 9999px;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        gap: 0.18rem;
        font-weight: 700;
        background: linear-gradient(145deg, rgba(98, 33, 160, 0.9), rgba(33, 12, 56, 0.92));
        border: 1px solid rgba(248, 250, 252, 0.35);
        color: #fef2ff;
        box-shadow: 0 8px 18px rgba(60, 9, 90, 0.4);
        text-align: center;
        padding: 6px 6px 8px;
      }

      .level-circle__value {
        font-size: 1.2rem;
        line-height: 1;
      }

      .level-progress {
        width: 82%;
        height: 7px;
        border-radius: 999px;
        background: rgba(255, 255, 255, 0.25);
        overflow: hidden;
        margin-top: 2px;
        position: relative;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .level-progress__fill {
        position: absolute;
        inset: 0;
        width: 0%;
        background: linear-gradient(90deg, #f97316, #facc15);
        border-radius: inherit;
        transition: width 0.3s ease;
        z-index: 0;
      }

      .level-progress__label {
        position: absolute;
        inset: 0;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 0.52rem;
        letter-spacing: 0.08em;
        text-transform: uppercase;
        font-weight: 600;
        color: rgba(15, 23, 42, 0.9);
        pointer-events: none;
        z-index: 1;
      }

      .location-pill {
        position: relative;
        flex: 0 0 auto;
        height: 68px;
        width: 68px;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        border-radius: 16px;
        border: 1px solid rgba(169, 211, 255, 0.35);
        background: linear-gradient(165deg, rgba(79, 70, 229, 0.92), rgba(15, 23, 42, 0.95));
        color: rgba(247, 241, 255, 0.95);
        transition: transform 0.2s ease, box-shadow 0.2s ease;
        margin-top: -28px;
        box-shadow: 0 24px 48px rgba(3, 4, 15, 0.7);
      }

      .location-pill::before {
        content: "";
        position: absolute;
        inset: 2px;
        border-radius: inherit;
        background: radial-gradient(circle at 30% 20%, rgba(255, 255, 255, 0.25), transparent 55%);
        opacity: 0.7;
        pointer-events: none;
      }

      .location-pill.is-active {
        border-color: rgba(255, 255, 255, 0.75);
        box-shadow: 0 24px 45px rgba(76, 29, 149, 0.55);
      }

      .location-pill::after {
        content: attr(data-label);
        position: absolute;
        bottom: 115%;
        left: 50%;
        transform: translateX(-50%);
        padding: 0.18rem 0.6rem;
        border-radius: 9999px;
        background: rgba(6, 11, 26, 0.95);
        border: 1px solid rgba(148, 163, 184, 0.4);
        color: #f8fafc;
        font-size: 0.7rem;
        letter-spacing: 0.08em;
        text-transform: uppercase;
        opacity: 0;
        pointer-events: none;
        white-space: nowrap;
        transition: opacity 0.2s ease, transform 0.2s ease;
      }

      .location-pill:hover {
        transform: translateY(-4px) scale(1.06);
        box-shadow: 0 26px 45px rgba(76, 29, 149, 0.5);
      }

      .location-pill:hover::after {
        opacity: 1;
        transform: translate(-50%, -4px);
      }

      .location-pill__icon {
        width: 32px;
        height: 32px;
        position: relative;
        z-index: 1;
        stroke: rgba(248, 250, 252, 0.95);
        fill: none;
        stroke-width: 1.8;
        stroke-linecap: round;
        stroke-linejoin: round;
      }

      .location-pill__icon--solid {
        fill: rgba(248, 250, 252, 0.85);
        stroke: none;
      }

      .city-footer {
        position: fixed;
        left: 0;
        bottom: 0;
        width: 100%;
        z-index: 25;
        pointer-events: none;
      }

      .task-bar {
        position: fixed;
        right: 1.5rem;
        bottom: 90px;
        width: min(360px, 80vw);
        z-index: 30;
        pointer-events: none;
      }

      .task-card {
        pointer-events: auto;
        width: 100%;
        text-align: left;
        border-radius: 20px;
        border: 1px solid rgba(147, 197, 253, 0.45);
        background: linear-gradient(135deg, rgba(74, 43, 177, 0.6), rgba(22, 27, 54, 0.85));
        padding: 1rem;
        display: flex;
        flex-direction: column;
        gap: 0.75rem;
        box-shadow: 0 22px 45px rgba(6, 10, 25, 0.65);
        transition: transform 0.2s ease, box-shadow 0.2s ease;
      }

      .task-card:hover {
        transform: translateY(-3px);
        box-shadow: 0 25px 50px rgba(2, 6, 23, 0.7);
      }

      .task-card__meta {
        font-size: 0.7rem;
        letter-spacing: 0.25em;
        text-transform: uppercase;
        color: rgba(148, 163, 184, 0.8);
      }

      .task-card__title {
        font-size: 1rem;
        font-weight: 600;
        color: #e2e8f0;
      }

      .task-card__summary {
        font-size: 0.85rem;
        color: rgba(226, 232, 240, 0.85);
      }

      .task-card__progress {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        font-size: 0.7rem;
        letter-spacing: 0.25em;
        text-transform: uppercase;
        color: rgba(148, 163, 184, 0.8);
      }

      .task-card__progress-bar {
        flex: 1;
        height: 4px;
        border-radius: 9999px;
        background: rgba(148, 163, 184, 0.25);
        overflow: hidden;
      }

      .task-card__progress-bar-fill {
        height: 100%;
        width: 0%;
        background: linear-gradient(90deg, #a855f7, #22d3ee);
      }

      .location-bar {
        pointer-events: auto;
        width: 100%;
        padding: 0.5rem 1.5rem 0.7rem;
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 1.25rem;
        max-width: 100%;
        background: rgba(7, 6, 18, 0.4);
      }

      .footer-content {
        width: 100%;
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 1rem;
      }

      .location-grid {
        display: flex;
        flex-wrap: nowrap;
        gap: 0.65rem;
        align-items: flex-end;
      }

      .footer-resources {
        display: flex;
        align-items: center;
        gap: 0.6rem;
        flex-wrap: wrap;
        justify-content: flex-end;
      }

      .energy-meter {
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      .energy-meter__label {
        font-size: 0.6rem;
        letter-spacing: 0.18em;
        text-transform: uppercase;
        color: rgba(226, 232, 240, 0.75);
      }

      .energy-meter__bar {
        height: 5px;
        width: 120px;
        border-radius: 9999px;
        background: rgba(148, 163, 184, 0.25);
        overflow: hidden;
        position: relative;
      }

      .energy-meter__bar-fill {
        position: absolute;
        inset: 0;
        background: linear-gradient(90deg, #fbba18, #fb7185);
        width: 0;
      }

      .energy-meter__value {
        font-size: 0.75rem;
        letter-spacing: 0.08em;
        text-transform: uppercase;
        color: #fefce8;
      }

      .resource-pill {
        display: inline-flex;
        align-items: center;
        gap: 0.35rem;
        padding: 0.3rem 0.7rem;
        border-radius: 9999px;
        border: 1px solid rgba(148, 163, 184, 0.3);
        background: rgba(15, 23, 42, 0.85);
        font-size: 0.78rem;
        font-weight: 600;
      }

      @media (max-width: 900px) {
        .location-bar {
          flex-direction: column;
          align-items: stretch;
          gap: 0.75rem;
          padding: 0.6rem 1rem 0.9rem;
        }
        .footer-content {
          flex-direction: column;
          align-items: stretch;
          gap: 0.75rem;
        }
        .location-grid {
          justify-content: flex-start;
          flex-wrap: wrap;
        }
        .location-pill {
          flex: 1 1 45%;
          height: 60px;
          width: 100%;
          margin-top: -10px;
        }
        .footer-resources {
          justify-content: flex-start;
          flex-wrap: wrap;
        }
      }

      .panel-card {
        position: fixed;
        left: 50%;
        top: 50%;
        transform: translate(-50%, -50%);
        width: min(720px, 92vw);
        background: rgba(2, 6, 23, 0.96);
        border: 1px solid rgba(148, 163, 184, 0.25);
        border-radius: 24px;
        box-shadow: 0 30px 90px rgba(3, 6, 18, 0.55);
        backdrop-filter: blur(28px);
        padding: 1.75rem;
        z-index: 20;
      }

      .lab-action-btn[disabled] {
        opacity: 0.45;
        cursor: not-allowed;
      }

      .lab-hero {
        background: radial-gradient(circle at 20% 20%, rgba(245, 158, 11, 0.25), transparent 45%),
          radial-gradient(circle at 80% 0%, rgba(14, 165, 233, 0.25), transparent 40%),
          rgba(15, 23, 42, 0.8);
        border: 1px solid rgba(255, 255, 255, 0.08);
        box-shadow: 0 25px 60px rgba(0, 0, 0, 0.45);
      }
      .lab-chip {
        border-radius: 999px;
        padding: 0.15rem 0.75rem;
        font-size: 0.65rem;
        letter-spacing: 0.2em;
        text-transform: uppercase;
      }
      .lab-gauge {
        position: relative;
        height: 12px;
        border-radius: 999px;
        overflow: hidden;
        background: rgba(15, 23, 42, 0.55);
      }
      .lab-gauge__fill {
        position: absolute;
        inset: 0;
        width: 30%;
        border-radius: inherit;
        background: linear-gradient(90deg, #f59e0b, #e11d48);
      }
      .lab-grid-card {
        border-radius: 1.25rem;
        border: 1px solid rgba(255, 255, 255, 0.06);
        background: linear-gradient(135deg, rgba(15, 23, 42, 0.9), rgba(15, 23, 42, 0.7));
      }

      #timetableCard {
        left: 4%;
        right: auto;
        top: 50%;
        bottom: auto;
        transform: translate(0, -50%);
        width: 75%;
        max-width: 960px;
      }

      #cityInfoPanel {
        left: 4%;
        right: auto;
        top: 50%;
        bottom: auto;
        transform: translate(0, -50%);
        width: 75%;
        max-width: 960px;
      }

      #labPanel {
        left: 4%;
        right: auto;
        top: 50%;
        bottom: auto;
        transform: translate(0, -50%);
        width: 75%;
        max-width: 960px;
      }

      #workshopPanel {
        left: 4%;
        right: auto;
        top: 50%;
        bottom: auto;
        transform: translate(0, -50%);
        width: 75%;
        max-width: 960px;
      }

      #taskDetailPanel {
        left: 4%;
        right: auto;
        top: 50%;
        bottom: auto;
        transform: translate(0, -50%);
        width: 75%;
        max-width: 960px;
      }

      #cityInfoMapWrapper {
        width: 100%;
        max-width: 520px;
      }

      #timetableCard table {
        font-size: 0.72rem;
      }

      #timetableCard thead {
        font-size: 0.62rem;
      }

      #timetableCard tbody td {
        line-height: 1.15;
        padding-top: 0.35rem;
        padding-bottom: 0.35rem;
      }

      .panel-card table {
        width: 100%;
        border-collapse: collapse;
      }

      .panel-card th,
      .panel-card td {
        padding: 0.5rem 0.75rem;
      }

      .panel-card thead {
        text-transform: uppercase;
        letter-spacing: 0.1em;
        font-size: 0.65rem;
        color: rgba(226, 232, 240, 0.75);
      }

      .panel-card tbody td {
        border-top: 1px solid rgba(148, 163, 184, 0.2);
        font-size: 0.85rem;
      }

      .timetable-raised {
        transform: translate(-50%, -55%);
      }

      @media (max-width: 640px) {
        .top-bar,
        .location-bar {
          border-radius: 24px;
        }
        .level-circle {
          height: 56px;
          width: 56px;
          font-size: 1.2rem;
        }
        .location-pill {
          flex: 1 1 100%;
        }
      }
    </style>
  </head>
  <body>
    <div class="city-stage">
      <div id="canvasBlock">
        <div class="city-cover">
          <div id="skyGradient"></div>
          <img id="cityBackdrop" src="" alt="Panorama mƒõsta" onerror="this.classList.add('opacity-0');" />
          <div id="nightOverlay"></div>
          <div id="daySunOverlay"></div>
          <canvas id="gameCanvas" width="1024" height="576"></canvas>
        </div>
      </div>

      <div class="ui-layer">
        <header class="flex justify-center">
          <div class="top-bar w-full max-w-4xl px-4 py-3">
            <div class="flex flex-wrap items-center justify-between gap-3 text-slate-100/90">
              <div>
                <h1 id="currentCityName" class="text-lg font-semibold">-</h1>
                <p id="currentCityState" class="text-xs uppercase tracking-[0.25em] text-slate-300">-</p>
              </div>
              <div class="flex items-center gap-4">
                <div class="text-right leading-tight">
                  <p class="text-[10px] uppercase tracking-[0.35em] text-slate-400" id="currentWeekLabel">T√Ωden 1</p>
                  <p id="currentTimeLabel" class="text-xl font-semibold tracking-[0.2em] text-slate-100">
                    Po 08:00
                  </p>
                </div>
                <div class="level-circle">
                  <span class="level-circle__value" id="agentLevel">1</span>
                  <div class="level-progress" aria-live="polite">
                    <div class="level-progress__fill" id="agentLevelProgress"></div>
                    <span class="level-progress__label" id="agentXpToNext">100 XP</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </header>

      </div>

      <div id="taskDetailPanel" class="panel-card hidden">
        <div class="flex flex-wrap items-start justify-between gap-4 mb-5">
          <div>
            <p class="text-[11px] uppercase tracking-[0.3em] text-slate-400">Operaƒçn√≠ briefing</p>
            <h3 id="taskDetailTitle" class="text-xl font-semibold">Vyber √∫kol</h3>
            <p id="taskDetailSubtitle" class="text-sm text-slate-300">Klikni na jednu z lokac√≠ a p≈ôiprav pl√°n.</p>
          </div>
          <button
            id="closeTaskDetailBtn"
            type="button"
            class="text-xs uppercase tracking-[0.3em] text-slate-200 border border-white/20 rounded-full px-4 py-2"
          >
            Zpƒõt
          </button>
        </div>
        <div class="grid gap-4 md:grid-cols-[220px_1fr]">
          <div id="taskListContainer" class="space-y-3 text-sm text-slate-200">
            <p>≈Ω√°dn√© aktivn√≠ √∫koly.</p>
          </div>
          <div class="space-y-4">
            <div class="flex flex-wrap items-center gap-3 text-sm text-slate-300">
              <div class="rounded-full border border-white/20 px-3 py-1 text-[10px] uppercase tracking-[0.3em] text-slate-200">
                <span id="taskDetailLocation">---</span>
              </div>
              <span>Priorita: <span id="taskDetailPriority" class="text-slate-50 font-semibold">-</span></span>
              <span>ƒåasov√Ω r√°mec: <span id="taskDetailEta" class="text-slate-50 font-semibold">-</span></span>
            </div>
            <p id="taskDetailDesc" class="text-sm leading-relaxed text-slate-200">
              Vyber √∫kol z nab√≠dky vlevo a zobraz√≠ se ti kompletn√≠ podklady.
            </p>
            <div>
              <p class="text-[11px] uppercase tracking-[0.3em] text-slate-400 mb-2">Kroky operace</p>
              <ul id="taskObjectiveList" class="space-y-2 text-sm text-slate-100">
                <li class="text-slate-400">≈Ω√°dn√Ω √∫kol nen√≠ aktivn√≠.</li>
              </ul>
            </div>
            <div class="grid sm:grid-cols-2 gap-4 text-sm">
              <div class="rounded-xl border border-emerald-400/30 bg-emerald-500/10 px-3 py-2">
                <p class="text-[10px] uppercase tracking-[0.3em] text-emerald-200/80">Odmƒõna</p>
                <p id="taskRewardLabel" class="text-base font-semibold text-emerald-100">-</p>
              </div>
              <div class="rounded-xl border border-slate-400/30 bg-slate-500/10 px-3 py-2">
                <p class="text-[10px] uppercase tracking-[0.3em] text-slate-200/80">Status</p>
                <p id="taskStatusLabel" class="text-base font-semibold text-slate-100">-</p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div id="cityInfoPanel" class="panel-card hidden">
        <div class="flex flex-col gap-6 lg:flex-row lg:items-center">
          <div class="flex-1 space-y-4">
            <div class="flex items-center justify-between">
              <div>
                <p class="text-[11px] uppercase tracking-[0.3em] text-amber-200/70">Informaƒçn√≠ centrum</p>
                <h3 id="cityInfoName" class="text-lg font-semibold">-</h3>
                <p id="cityInfoMeta" class="text-sm text-slate-300">Vyber mƒõsto na mapƒõ</p>
                <p id="cityInfoPopulation" class="text-sm font-semibold text-amber-200">Poƒçet obyvatel: -</p>
              </div>
            </div>
            <p id="cityInfoDesc" class="text-xs leading-relaxed text-slate-200 whitespace-pre-line">
              P≈ôepni na mƒõsto a uk√°≈æeme ti detaily.
            </p>
            <div id="cityInfoDetails" class="space-y-3 text-sm text-slate-200">
              <!-- Budouc√≠ dopl≈àuj√≠c√≠ informace -->
            </div>
          </div>
          <div
            id="cityInfoMapWrapper"
            class="rounded-2xl overflow-hidden relative max-w-[520px] w-full lg:w-auto"
          >
            <canvas
              id="cityInfoMap"
              width="520"
              height="300"
              class="block max-w-full"
              aria-label="Mapa mƒõsta a p≈ôilehl√Ωch tras"
            ></canvas>
            <div
              id="cityInfoMapTooltip"
              class="absolute pointer-events-none px-2 py-1 rounded-md text-[11px] tracking-wide uppercase bg-slate-900/90 border border-white/20 text-slate-100 shadow-lg hidden"
            ></div>
          </div>
        </div>
      </div>

      <div id="labPanel" class="panel-card hidden space-y-6">
        <div class="lab-hero rounded-3xl p-6 flex flex-col gap-4">
          <div class="flex flex-wrap items-center justify-between gap-4">
            <div>
              <p class="lab-chip bg-amber-200/15 text-amber-200">Laborato≈ô</p>
              <h3 class="text-2xl font-semibold text-white mt-2">Centrum bio-anal√Ωz</h3>
              <p class="text-sm text-slate-200/80">≈Ωiv√© p≈ôehledy senzor≈Ø a rychl√© z√°sahy proti mlze.</p>
            </div>
            <div class="text-4xl" aria-hidden="true">üß™</div>
          </div>
          <div class="grid gap-4 sm:grid-cols-[1.1fr_0.9fr]">
            <div class="lab-grid-card p-4 space-y-3">
              <div class="flex items-center justify-between">
                <p class="text-[11px] uppercase tracking-[0.3em] text-slate-300">√örove≈à ≈°√≠≈ôen√≠</p>
                <span class="text-xs text-slate-400">≈Ωiv√° telemetrie</span>
              </div>
              <div class="flex items-center gap-4">
                <div>
                  <p id="labFogLevelLabel" class="text-4xl font-bold text-amber-200">-</p>
                  <p id="labFogLevelDesc" class="text-sm text-slate-300">-</p>
                </div>
                <div class="flex-1 space-y-2">
                  <div class="lab-gauge">
                    <div id="labFogLevelBar" class="lab-gauge__fill"></div>
                  </div>
                  <p class="text-[11px] uppercase tracking-[0.2em] text-slate-400">Rychlost postupu</p>
                </div>
              </div>
            </div>
            <div class="grid gap-3 sm:grid-cols-2">
              <div class="lab-grid-card p-4">
                <p class="text-xs text-slate-400">Senzorick√° data</p>
                <p class="text-2xl font-semibold text-sky-200">+</p>
                <p class="text-xs text-slate-300">Aktualizace ka≈æd√Ωch 15 min</p>
              </div>
              <div class="lab-grid-card p-4">
                <p class="text-xs text-slate-400">Vzorky ve frontƒõ</p>
                <p class="text-2xl font-semibold text-rose-200">4</p>
                <p class="text-xs text-slate-300">ƒåekaj√≠ na anal√Ωzu</p>
              </div>
            </div>
          </div>
        </div>

        <div class="grid gap-4 lg:grid-cols-[1.2fr_1fr]">
          <section class="space-y-4">
            <div class="flex items-center justify-between">
              <p class="text-sm font-semibold text-slate-200">Analytick√© re≈æimy</p>
              <span class="text-xs text-slate-400">Hlubok√© skeny</span>
            </div>
            <div class="grid gap-3 sm:grid-cols-2">
              <button type="button" class="lab-action-btn rounded-2xl border border-sky-400/40 bg-gradient-to-br from-sky-500/15 to-indigo-500/15 px-4 py-4 text-left hover:from-sky-500/25 hover:to-indigo-500/25 transition" data-action-code="fog_analysis">
                <div class="flex items-center gap-2">
                  <span class="text-xl">üî¨</span>
                  <div class="flex-1">
                    <p class="text-sm font-semibold text-slate-100">Anal√Ωza mlhy</p>
                    <p class="text-xs text-slate-300">Rozklad ƒç√°stic, hustota</p>
                  </div>
                </div>
                <p class="text-[11px] mt-3 text-slate-400">Status: <span class="text-amber-200 hidden" data-action-status></span></p>
              </button>
              <button type="button" class="lab-action-btn rounded-2xl border border-violet-400/40 bg-gradient-to-br from-purple-500/15 to-pink-500/15 px-4 py-4 text-left hover:from-purple-500/25 hover:to-pink-500/25 transition" data-action-code="direction_detection">
                <div class="flex items-center gap-2">
                  <span class="text-xl">üß≠</span>
                  <div class="flex-1">
                    <p class="text-sm font-semibold text-slate-100">Detekce smƒõru</p>
                    <p class="text-xs text-slate-300">Predictivn√≠ model ≈°√≠≈ôen√≠</p>
                  </div>
                </div>
                <p class="text-[11px] mt-3 text-slate-400">Status: <span class="text-amber-200 hidden" data-action-status></span></p>
              </button>
            </div>
          </section>

          <section class="space-y-4">
            <div class="flex items-center justify-between">
              <p class="text-sm font-semibold text-slate-200">Taktick√© z√°sahy</p>
              <span class="text-xs text-slate-400">Deploymenty</span>
            </div>
            <div class="grid gap-3 sm:grid-cols-3">
              <button type="button" class="lab-action-btn rounded-2xl border border-amber-400/40 bg-gradient-to-br from-amber-500/15 to-orange-500/15 px-3 py-4 text-left hover:from-amber-500/25 hover:to-orange-500/25 transition" data-action-code="slow_spread">
                <div class="flex items-center justify-between gap-2">
                  <span class="text-lg">üåÄ</span>
                  <span class="text-[11px] uppercase tracking-[0.25em] text-amber-100 hidden" data-action-status></span>
                </div>
                <p class="text-sm font-semibold text-slate-100 mt-2">Zpomalen√≠ ≈°√≠≈ôen√≠</p>
                <p class="text-xs text-slate-300">Tlumen√≠ expanze</p>
              </button>
              <button type="button" class="lab-action-btn rounded-2xl border border-emerald-400/40 bg-gradient-to-br from-emerald-500/15 to-teal-500/15 px-3 py-4 text-left hover:from-emerald-500/25 hover:to-teal-500/25 transition" data-action-code="local_filter">
                <div class="flex items-center justify-between gap-2">
                  <span class="text-lg">üõ°Ô∏è</span>
                  <span class="text-[11px] uppercase tracking-[0.25em] text-amber-100 hidden" data-action-status></span>
                </div>
                <p class="text-sm font-semibold text-slate-100 mt-2">Lok√°ln√≠ filtr</p>
                <p class="text-xs text-slate-300">Stabilizace mƒõsta</p>
              </button>
              <button type="button" class="lab-action-btn rounded-2xl border border-rose-400/40 bg-gradient-to-br from-rose-500/15 to-red-500/15 px-3 py-4 text-left hover:from-rose-500/25 hover:to-red-500/25 transition" data-action-code="local_serum">
                <div class="flex items-center justify-between gap-2">
                  <span class="text-lg">üíâ</span>
                  <span class="text-[11px] uppercase tracking-[0.25em] text-amber-100 hidden" data-action-status></span>
                </div>
                <p class="text-sm font-semibold text-slate-100 mt-2">Lok√°ln√≠ s√©rum</p>
                <p class="text-xs text-slate-300">Neutralizace lo≈æisek</p>
              </button>
            </div>
          </section>
        </div>
      </div>

      <div id="workshopPanel" class="panel-card hidden space-y-6">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-[11px] uppercase tracking-[0.3em] text-orange-200/70">D√≠lna</p>
            <h3 class="text-lg font-semibold text-slate-50">V√Ωroba prototyp≈Ø</h3>
            <p class="text-sm text-slate-300">Spravuj pl√°ny, materi√°l a provoz modularn√≠ch stanic.</p>
          </div>
          <span class="text-3xl" aria-hidden="true">üõ†Ô∏è</span>
        </div>

        <section class="space-y-3">
          <div>
            <p class="text-[11px] uppercase tracking-[0.3em] text-slate-400">1) Z√°kladn√≠ parametry</p>
            <h4 class="text-base font-semibold text-slate-100">Stav d√≠lny</h4>
          </div>
          <div class="grid gap-3 sm:grid-cols-3 text-sm text-slate-200">
            <div class="rounded-2xl border border-white/10 bg-slate-900/70 p-4">
              <p class="text-[10px] uppercase tracking-[0.3em] text-slate-400">√örove≈à</p>
              <p id="workshopLevelLabel" class="text-2xl font-bold text-white">-</p>
            </div>
            <div class="rounded-2xl border border-white/10 bg-slate-900/70 p-4">
              <p class="text-[10px] uppercase tracking-[0.3em] text-slate-400">Kapacity</p>
              <p id="workshopCapacityLabel" class="text-2xl font-bold text-amber-200">-</p>
            </div>
            <div class="rounded-2xl border border-white/10 bg-slate-900/70 p-4">
              <p class="text-[10px] uppercase tracking-[0.3em] text-slate-400">Aktivn√≠ v√Ωroby</p>
              <p id="workshopQueueLabel" class="text-2xl font-bold text-emerald-200">-</p>
            </div>
          </div>
        </section>

        <section class="space-y-3">
          <div>
            <p class="text-[11px] uppercase tracking-[0.3em] text-slate-400">2) Blueprinty</p>
            <h4 class="text-base font-semibold text-slate-100">Dostupn√© recepty</h4>
          </div>
          <div class="rounded-2xl border border-slate-800 bg-slate-900/70 divide-y divide-slate-800" id="workshopBlueprintList">
            <div class="p-4 text-sm text-slate-300">Zat√≠m ≈æ√°dn√© pl√°ny.</div>
          </div>
        </section>

        <section class="space-y-3">
          <div>
            <p class="text-[11px] uppercase tracking-[0.3em] text-slate-400">3) V√Ωroba</p>
            <h4 class="text-base font-semibold text-slate-100">Akce d√≠lny</h4>
          </div>
          <div class="grid gap-3 sm:grid-cols-3" id="workshopActionGrid">
            <button type="button" class="rounded-2xl border border-amber-500/30 bg-amber-500/10 px-3 py-4 text-left text-sm text-slate-100 hover:bg-amber-500/20 transition" disabled>
              <p class="font-semibold">Vyber blueprint</p>
              <p class="text-xs text-slate-300">Najdi pl√°n a spus≈• v√Ωrobn√≠ linku.</p>
            </button>
            <button type="button" class="rounded-2xl border border-emerald-500/30 bg-emerald-500/10 px-3 py-4 text-left text-sm text-slate-100 hover:bg-emerald-500/20 transition" disabled>
              <p class="font-semibold">Spr√°va fronty</p>
              <p class="text-xs text-slate-300">Zde se objev√≠ aktivn√≠ projekty.</p>
            </button>
            <button type="button" class="rounded-2xl border border-sky-500/30 bg-sky-500/10 px-3 py-4 text-left text-sm text-slate-100 hover:bg-sky-500/20 transition" disabled>
              <p class="font-semibold">Upgrade d√≠lny</p>
              <p class="text-xs text-slate-300">Odemkni dal≈°√≠ sloty pro v√Ωrobu.</p>
            </button>
          </div>
        </section>
      </div>

      <div id="timetableCard" class="panel-card hidden space-y-4">
        <div class="flex items-center gap-3">
          <span class="text-2xl">üöâ</span>
          <div>
            <p class="text-[11px] uppercase tracking-[0.3em] text-slate-400">J√≠zdn√≠ ≈ô√°d</p>
            <h3 class="text-lg font-semibold text-slate-100">Odjezdy</h3>
          </div>
        </div>
        <div class="overflow-x-auto rounded-2xl border border-white/10 bg-slate-950/40">
          <table id="timetableTable" class="tabular-nums">
            <thead>
              <tr>
                <th class="text-left">üïí Odjezd</th>
                <th class="text-left">‚û°Ô∏è Smƒõr</th>
                <th class="text-left">üöÜ Typ</th>
                <th class="text-left">üìè Vzd√°l.</th>
                <th class="text-left">‚è≥ ƒåas</th>
                <th class="text-left">üèÅ P≈ô√≠jezd</th>
                <th class="text-left">üéüÔ∏è Ticket</th>
              </tr>
            </thead>
            <tbody id="timetableBody" class="text-slate-200">
              <!-- dynamick√° data -->
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <div class="task-bar">
      <button id="taskCard" type="button" class="task-card">
        <div class="flex items-center gap-3">
          <span class="inline-flex h-10 w-10 items-center justify-center rounded-full bg-white/10 text-lg">üìã</span>
          <div>
            <p class="task-card__meta" id="currentTaskMeta">-</p>
            <p class="task-card__title" id="currentTaskTitle">≈Ω√°dn√© zad√°n√≠</p>
          </div>
        </div>
        <p class="task-card__summary" id="currentTaskSummary">
          Velitelstv√≠ zat√≠m neposlalo ≈æ√°dnou operaci. Sleduj kan√°l HQ.
        </p>
        <div class="task-card__progress">
          <span id="currentTaskProgressLabel">0%</span>
          <div class="task-card__progress-bar">
            <div id="currentTaskProgressBar" class="task-card__progress-bar-fill"></div>
          </div>
        </div>
      </button>
    </div>

    <div class="city-footer">
      <div class="location-bar">
        <div class="footer-content">
          <div class="location-grid">
            <button id="cityHubBtn" class="location-pill" data-label="√övod" aria-label="√övod">
              <svg class="location-pill__icon" viewBox="0 0 32 32" role="presentation">
                <path d="M6 14L16 6l10 8" />
                <path d="M8 14v12h6v-7h4v7h6V14" />
              </svg>
            </button>
            <button id="ticketToggleBtn" class="location-pill" data-label="N√°dra≈æ√≠" aria-label="N√°dra≈æ√≠">
              <svg class="location-pill__icon" viewBox="0 0 32 32" role="presentation">
                <path d="M8 10h16a2 2 0 0 1 2 2v9a3 3 0 0 1-3 3H9a3 3 0 0 1-3-3v-9a2 2 0 0 1 2-2z" />
                <path d="M8 16h16" />
                <circle cx="12" cy="19" r="1.4" />
                <circle cx="20" cy="19" r="1.4" />
                <path d="M12 24l-2 3m12-3l2 3" />
              </svg>
            </button>
            <button id="infoCenterBtn" class="location-pill" data-label="Infocentrum" aria-label="Informaƒçn√≠ centrum">
              <svg class="location-pill__icon" viewBox="0 0 32 32" role="presentation">
                <path d="M6 12h20l-10-6z" />
                <path d="M10 12v12m4-12v12m4-12v12m4-12v12" />
                <path d="M6 24h20" />
              </svg>
            </button>
            <button id="bankBtn" class="location-pill" data-label="Banka" aria-label="Banka">
              <svg class="location-pill__icon" viewBox="0 0 32 32" role="presentation">
                <rect x="6" y="10" width="20" height="12" rx="2" ry="2" />
                <path d="M6 15h20" />
                <circle cx="12" cy="21" r="2.2" />
                <path d="M18 20h5" />
              </svg>
            </button>
            <button id="labBtn" class="location-pill" data-label="Laborato≈ô" aria-label="Laborato≈ô">
              <svg class="location-pill__icon" viewBox="0 0 32 32" role="presentation">
                <path d="M12 6v7l-5 9a4 4 0 0 0 3.5 6h11a4 4 0 0 0 3.5-6l-5-9V6" />
                <path d="M12 13h8" />
                <path d="M10 22h12" />
                <circle cx="13" cy="19" r="1" />
                <circle cx="19" cy="20.5" r="1" />
              </svg>
            </button>
            <button id="workshopBtn" class="location-pill" data-label="D√≠lna" aria-label="D√≠lna">
              <svg class="location-pill__icon" viewBox="0 0 32 32" role="presentation">
                <path d="M9 12l5 5-2 2-5-5" />
                <path d="M20 8l4 4-7 7-4-4z" />
                <path d="M17 23l4 4" />
                <path d="M22 18l4 4" />
              </svg>
            </button>
            <button class="location-pill" data-label="Trh" aria-label="Trh">
              <svg class="location-pill__icon" viewBox="0 0 32 32" role="presentation">
                <path d="M7 12h18l-2 13H11L9 8H5" />
                <circle cx="14" cy="25" r="1.5" />
                <circle cx="22" cy="25" r="1.5" />
                <path d="M12 17h11" />
              </svg>
            </button>
            <button id="hqBtn" class="location-pill" data-label="HQ kan√°l" aria-label="HQ kan√°l">
              <svg class="location-pill__icon" viewBox="0 0 32 32" role="presentation">
                <circle cx="16" cy="16" r="8" />
                <path d="M8 16h16" />
                <path d="M16 8a20 20 0 0 1 0 16m0-16a20 20 0 0 0 0 16" />
              </svg>
            </button>
          </div>
          <div class="footer-resources">
            <div class="energy-meter">
              <div class="energy-meter__label">Energie</div>
              <div class="energy-meter__bar">
                <div id="agentEnergyBarFill" class="energy-meter__bar-fill"></div>
              </div>
              <div class="energy-meter__value" id="agentEnergyLabel">0 / 100</div>
            </div>
            <div class="resource-pill">
              <span>üßÆ</span>
              <span id="agentDataLabel">0 / 100</span>
            </div>
            <div class="resource-pill">
              <span>üß±</span>
              <span id="agentMaterialLabel">0 / 100</span>
            </div>
            <div class="resource-pill">
              <span>üí∞</span>
              <span id="agentCreditsLabel">0</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div
      id="travelOverlay"
      class="fixed inset-0 bg-slate-950/90 backdrop-blur hidden z-50 flex items-center justify-center px-4"
    >
      <div class="travel-card bg-slate-900/90 border border-slate-800 rounded-2xl shadow-[0_20px_80px_rgba(0,0,0,0.6)] relative overflow-visible w-[min(720px,90vw)] px-6 pt-24 pb-6">
        <div class="travel-top-row flex justify-between items-end">
          <div class="travel-top-info flex flex-col gap-1">
            <div class="travel-top-type text-lg font-bold text-slate-100" id="travelTopType">-</div>
            <div class="travel-top-speed text-sm text-slate-300" id="travelTopSpeed">-</div>
          </div>
          <div class="travel-train-wrap pointer-events-none absolute -top-16 right-2 opacity-95 rotate-[-2deg]">
            <img id="travelTrainImg" src="/static/assets/train_1.png" alt="Train" class="max-w-[440px] drop-shadow-[0_18px_22px_rgba(0,0,0,0.55)]" />
          </div>
        </div>

        <div class="travel-clock text-center text-5xl font-extrabold text-sky-100 mt-6 mb-3 leading-tight" id="travelClockLabel">-</div>
        <div class="travel-progress-header flex justify-between text-2xl text-slate-100 font-bold tracking-tight">
          <div id="travelProgressFrom" class="text-left">-</div>
          <div id="travelProgressTo" class="text-right">-</div>
        </div>
        <div class="travel-progress h-3 bg-slate-800 rounded-full overflow-hidden mt-2">
          <div id="travelProgressBar" class="travel-progress-bar h-full bg-gradient-to-r from-sky-400 via-slate-100 to-red-400 w-0"></div>
        </div>

        <div class="mt-6 grid grid-cols-2 gap-4 text-sm text-slate-200">
          <div>
            <div class="travel-label text-xs uppercase tracking-[0.12em] text-slate-400">Vzd√°lenost</div>
            <div class="travel-value text-base font-semibold" id="travelDistanceLabel">-</div>
          </div>
          <div>
            <div class="travel-label text-xs uppercase tracking-[0.12em] text-slate-400">ƒåas j√≠zdy</div>
            <div class="travel-value text-base font-semibold" id="travelDurationLabel">-</div>
          </div>
        </div>
      </div>
    </div>

    <script type="module" src="{{ url_for('static', filename='js/game.js') }}"></script>
  </body>
</html>
