<!doctype html>
<html lang="cs">
  <head>
    <meta charset="utf-8" />
    <title>Agent USA ‚Äì mƒõstsk√© menu</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      :root {
        --bg-deep-gradient: radial-gradient(120% 120% at 10% 20%, #1b2650 0%, #050c1d 55%, #030712 100%);
        --panel-gradient: linear-gradient(145deg, rgba(26, 32, 57, 0.95) 0%, rgba(9, 13, 25, 0.92) 100%);
        --panel-gradient-accent: linear-gradient(145deg, rgba(62, 47, 126, 0.94) 0%, rgba(18, 24, 45, 0.95) 55%, rgba(11, 16, 32, 0.95) 100%);
        --border-color: rgba(148, 163, 184, 0.2);
        --border-accent: rgba(129, 140, 248, 0.45);
        --glow-strong: 0 30px 85px rgba(4, 8, 20, 0.55);
        --glow-soft: 0 18px 60px rgba(4, 8, 20, 0.4);
      }

      body.brand-bg {
        background: var(--bg-deep-gradient);
        color: #e2e8f0;
      }

      .glass-panel {
        background: var(--panel-gradient);
        border: 1px solid var(--border-color);
        box-shadow: var(--glow-soft);
        backdrop-filter: blur(18px);
      }

      .glass-panel--accent {
        background: var(--panel-gradient-accent);
        border-color: var(--border-accent);
        box-shadow: var(--glow-strong);
      }

      .location-option {
        display: flex;
        align-items: center;
        gap: 0.85rem;
        border-radius: 0.9rem;
        padding: 0.65rem 0.95rem;
        position: relative;
        overflow: hidden;
        z-index: 0;
        background: linear-gradient(120deg, rgba(24, 33, 66, 0.9), rgba(10, 15, 31, 0.96));
        border: 1px solid rgba(129, 140, 248, 0.25);
        color: #f8fafc;
        transition: border-color 0.3s ease, transform 0.3s ease, background 0.3s ease, box-shadow 0.3s ease;
      }

      .location-option::before {
        content: "";
        position: absolute;
        inset: 0;
        background: radial-gradient(circle at 20% 50%, rgba(96, 165, 250, 0.45), transparent 55%);
        opacity: 0;
        z-index: 0;
        transition: opacity 0.3s ease;
      }

      .location-option:hover {
        border-color: rgba(191, 219, 254, 0.75);
        transform: translateY(-2px);
        box-shadow: 0 14px 36px rgba(3, 7, 18, 0.55);
      }

      .location-option:hover::before {
        opacity: 1;
      }

      .location-option__icon {
        position: relative;
        z-index: 1;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        height: 2.5rem;
        width: 2.5rem;
        border-radius: 1rem;
        background: linear-gradient(135deg, rgba(191, 219, 254, 0.18), rgba(59, 130, 246, 0.75));
        box-shadow: 0 4px 18px rgba(14, 165, 233, 0.35);
        font-size: 1.05rem;
      }

      .location-option__label {
        position: relative;
        z-index: 1;
        font-weight: 600;
        letter-spacing: 0.04em;
      }

      #timetableCard {
        transition: transform 0.3s ease, margin-top 0.3s ease, box-shadow 0.3s ease;
      }
      .timetable-raised {
        transform: translateY(-50vh);
        margin-top: -40px;
        box-shadow: 0 18px 36px rgba(0, 0, 0, 0.45);
      }
      #daySunOverlay {
        background: linear-gradient(180deg, rgba(59, 130, 246, 0.28) 0%, rgba(14, 165, 233, 0.18) 55%, rgba(14, 116, 144, 0.08) 100%);
        mix-blend-mode: multiply;
      }
    </style>
  </head>
  <body class="min-h-screen text-slate-100 brand-bg">
    <div class="w-[80%] mx-auto px-6 py-6 space-y-5">
      <header class="flex flex-wrap items-center justify-between gap-4 rounded-full px-4 py-3 glass-panel glass-panel--accent backdrop-blur">
        <div class="flex items-center gap-2">
          <div class="h-7 w-7 rounded-full bg-gradient-to-br from-sky-400 via-slate-50 to-rose-500 shadow-lg shadow-sky-500/30"></div>
          <p class="text-[11px] uppercase tracking-[0.35em] text-slate-100">Agent USA</p>
        </div>
        <div class="flex items-center gap-4 flex-wrap justify-end text-xs text-slate-100">
          <div class="flex items-center gap-2 pr-4 border-r border-white/15">
            <div class="flex flex-col">
              <p class="text-sm font-semibold">Level <span class="text-sky-100" id="agentLevel">1</span></p>
              <p class="text-[11px] text-slate-200/80" id="agentXpToNext">Do L2: 100 XP</p>
            </div>
            <div class="hidden sm:block">
              <div class="flex justify-between text-[10px] text-slate-100/80 mb-1">
                <span>XP</span>
                <span id="agentXpLabel">0 / 1 000</span>
              </div>
              <div class="h-2 w-32 rounded-full bg-white/15 overflow-hidden">
                <div id="agentXpBarFill" class="h-full w-0 bg-gradient-to-r from-sky-300 to-emerald-300"></div>
              </div>
            </div>
          </div>

          <div class="hidden sm:block min-w-[150px] pr-4 border-r border-white/15">
            <div class="flex justify-between text-[10px] text-slate-100/80 mb-1">
              <span>Energie</span>
              <span id="agentEnergyLabel">0 / 100</span>
            </div>
            <div class="h-2 w-full rounded-full bg-white/12 overflow-hidden">
              <div id="agentEnergyBarFill" class="h-full w-0 bg-gradient-to-r from-amber-200 to-rose-300"></div>
            </div>
          </div>

          <div class="flex items-center gap-4 text-[11px] font-semibold">
            <div class="flex items-center gap-1">
              <span class="text-sky-100">üßÆ</span>
              <span id="agentDataLabel">0 / 100</span>
            </div>
            <div class="flex items-center gap-1">
              <span class="text-amber-200">üß±</span>
              <span id="agentMaterialLabel">0 / 100</span>
            </div>
            <div class="flex items-center gap-1">
              <span class="text-emerald-200">üí∞</span>
              <span id="agentCreditsLabel">0</span>
            </div>
          </div>
        </div>
      </header>

      <section class="flex flex-wrap items-center justify-between gap-3 px-1 py-1">
        <div class="flex items-center gap-3">
         
          <div>
            <h2 id="currentCityName" class="text-xl font-bold text-slate-100">-</h2>
            <p id="currentCityState" class="text-sm text-slate-300">-</p>
          </div>
        </div>
        <div class="flex items-center gap-4 text-sm text-slate-200">
          <p class="text-[11px] uppercase tracking-[0.2em] text-slate-400">T√Ωden <span id="gameWeekLabel">1</span></p>
          <p id="currentTimeLabel" class="text-base font-semibold text-sky-100">Po 08:00</p>
        </div>
      </section>

      <div class="grid lg:grid-cols-[1.5fr_0.5fr] gap-5 items-start">
        <!-- Lev√Ω sloupec: canvas -->
        <main class="space-y-3">
          <div id="canvasBlock" class="relative overflow-hidden rounded-3xl glass-panel glass-panel--accent">
            <div class="absolute inset-0 z-0">
              <div id="skyGradient" class="absolute inset-0"></div>
              <img
                id="cityBackdrop"
                src=""
                alt="Panorama mƒõsta"
                class="relative h-full w-full object-cover opacity-95"
                onerror="this.classList.add('opacity-0');"
              />
              <div id="nightOverlay" class="absolute inset-0 pointer-events-none opacity-0 bg-slate-900/55 mix-blend-multiply transition-opacity duration-500"></div>
              <div
                id="daySunOverlay"
                class="absolute inset-0 pointer-events-none opacity-0 transition-opacity duration-500"
              ></div>
            </div>
            <div class="relative z-10 p-4">
              <div id="visualFrame" class="relative rounded-2xl overflow-hidden aspect-[16/9] bg-transparent">
                <canvas
                  id="gameCanvas"
                  width="1024"
                  height="576"
                  class="absolute inset-0 w-full h-full bg-slate-950/70"
                ></canvas>
              </div>
              
          </div>
        </div>

          <div
            id="taskDetailPanel"
            class="hidden glass-panel glass-panel--accent rounded-3xl p-5 space-y-4"
          >
            <div class="flex flex-wrap items-start justify-between gap-4">
              <div>
                <p class="text-[11px] uppercase tracking-[0.2em] text-violet-200/80">Operaƒçn√≠ briefing</p>
                <h3 id="taskDetailTitle" class="text-xl font-semibold text-slate-50">Vyber √∫kol</h3>
                <p id="taskDetailSubtitle" class="text-sm text-slate-300">Klikni na jednu z karet a p≈ôiprav si pl√°n.</p>
              </div>
              <button
                id="closeTaskDetailBtn"
                type="button"
                class="inline-flex items-center gap-2 rounded-full border border-white/15 px-4 py-2 text-xs font-semibold uppercase tracking-[0.18em] text-slate-100 hover:bg-white/10 transition"
              >
                <span>‚Ü©</span> Zpƒõt na mapu
              </button>
            </div>
            <div class="grid gap-5 md:grid-cols-[240px_1fr]">
              <div id="taskListContainer" class="space-y-3">
                <p class="text-sm text-slate-300">≈Ω√°dn√© aktivn√≠ √∫koly.</p>
              </div>
              <div class="rounded-2xl p-4 space-y-4 glass-panel">
                <div class="flex flex-wrap items-center gap-3">
                  <div class="rounded-xl bg-violet-500/20 border border-violet-400/40 px-3 py-1 text-[11px] uppercase tracking-[0.18em] text-violet-100">
                    <span id="taskDetailLocation">---</span>
                  </div>
                  <div class="text-xs text-slate-300">
                    Priorita: <span id="taskDetailPriority" class="font-semibold text-slate-100">-</span>
                  </div>
                  <div class="text-xs text-slate-300">
                    ƒåasov√Ω r√°mec: <span id="taskDetailEta" class="font-semibold text-slate-100">-</span>
                  </div>
                </div>
                <p id="taskDetailDesc" class="text-sm leading-relaxed text-slate-200">
                  Vyber √∫kol z nab√≠dky vlevo a zobraz√≠ se ti kompletn√≠ podklady.
                </p>
                <div>
                  <p class="text-[11px] uppercase tracking-[0.2em] text-slate-400 mb-2">Kroky operace</p>
                  <ul id="taskObjectiveList" class="space-y-2 text-sm text-slate-100">
                    <li class="text-slate-400">≈Ω√°dn√Ω √∫kol nen√≠ aktivn√≠.</li>
                  </ul>
                </div>
                <div class="grid sm:grid-cols-2 gap-4 text-sm">
                  <div class="rounded-xl border border-emerald-400/30 bg-emerald-500/10 px-3 py-2">
                    <p class="text-[10px] uppercase tracking-[0.2em] text-emerald-200/80">Odmƒõna</p>
                    <p id="taskRewardLabel" class="text-base font-semibold text-emerald-100">-</p>
                  </div>
                  <div class="rounded-xl border border-slate-400/30 bg-slate-500/10 px-3 py-2">
                    <p class="text-[10px] uppercase tracking-[0.2em] text-slate-200/80">Status</p>
                    <p id="taskStatusLabel" class="text-base font-semibold text-slate-100">-</p>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div
            id="cityInfoPanel"
            class="hidden glass-panel rounded-2xl p-4 space-y-3"
          >
            <div class="flex items-center justify-between">
              <div>
                <p class="text-[11px] uppercase tracking-[0.16em] text-amber-200/70">Informaƒçn√≠ centrum</p>
                <h3 id="cityInfoName" class="text-lg font-semibold text-slate-100">-</h3>
                <p id="cityInfoMeta" class="text-sm text-slate-300">Vyber mƒõsto na mapƒõ</p>
              </div>
              <span class="text-2xl">üó∫Ô∏è</span>
            </div>
            <p id="cityInfoDesc" class="text-sm leading-relaxed text-slate-200 whitespace-pre-line">
              P≈ôepni na mƒõsto a uk√°≈æeme ti mapu a detaily.
            </p>
          </div>

          <!-- Odjezdy schovan√© pod tlaƒç√≠tkem Stanice (st√°le napojen√© na JS) -->
          <div id="timetableCard" class="relative glass-panel rounded-2xl p-4 hidden">
            <div class="flex items-center mb-3">
              <h2 class="text-base font-semibold text-slate-100 flex items-center gap-2">
                <span class="text-sky-300">üöâ</span> J√≠zdn√≠ ≈ô√°d
              </h2>
            </div>

            <div class="overflow-x-auto rounded-xl bg-slate-900/70">
              <table id="timetableTable" class="min-w-full text-xs bg-transparent tabular-nums">
                <thead class="text-slate-200">
                  <tr class="uppercase tracking-[0.08em] text-[11px] text-slate-400">
                    <th class="px-3 py-2 text-left font-semibold">üïí Odjezd</th>
                    <th class="px-3 py-2 text-left font-semibold">‚û°Ô∏è Smƒõr j√≠zdy</th>
                    <th class="px-3 py-2 text-left font-semibold">üöÜ Typ</th>
                    <th class="px-3 py-2 text-left font-semibold">üìè Vzd√°l.</th>
                    <th class="px-3 py-2 text-left font-semibold">‚è≥ ƒåas j√≠zdy</th>
                    <th class="px-3 py-2 text-left font-semibold">üèÅ P≈ô√≠jezd</th>
                    <th class="px-3 py-2 text-left font-semibold">üéüÔ∏è Ticket</th>
                  </tr>
                </thead>
                <tbody id="timetableBody" class="divide-y divide-slate-800/60 text-slate-200">
                  <!-- pln√≠ JS -->
                </tbody>
              </table>
            </div>
          </div>
        </main>

        <!-- Prav√Ω sloupec: ovl√°d√°n√≠ -->
        <aside class="space-y-4">
          <section class="rounded-2xl glass-panel glass-panel--accent">
            <button
              id="taskCard"
              type="button"
              class="w-full text-left p-4 space-y-3 focus:outline-none focus:ring-2 focus:ring-violet-400/70 rounded-2xl"
            >
              <div class="flex items-center justify-between gap-3">
                <div class="flex items-center gap-3">
                  <span class="inline-flex h-10 w-10 items-center justify-center rounded-2xl bg-gradient-to-br from-violet-200 to-violet-500 text-lg shadow-md shadow-violet-900/40">üìã</span>
                  <div>
                    <p class="text-[11px] uppercase tracking-[0.3em] text-violet-100/80">Aktu√°ln√≠ √∫kol</p>
                    <h3 id="currentTaskTitle" class="text-base font-semibold text-slate-50">≈Ω√°dn√© zad√°n√≠</h3>
                  </div>
                </div>
                <span class="text-[11px] font-semibold tracking-[0.3em] uppercase text-violet-100/90 bg-white/5 px-3 py-1 rounded-full border border-white/10">Brief</span>
              </div>
              <p id="currentTaskSummary" class="text-sm text-slate-200">
                Velitelstv√≠ zat√≠m neposlalo ≈æ√°dnou operaci. Sleduj kan√°l HQ.
              </p>
              <div class="flex flex-wrap items-center justify-between gap-2 text-xs text-slate-300">
                <span id="currentTaskMeta" class="font-semibold text-slate-100/90">-</span>
                <div class="flex items-center gap-2 min-w-[140px]">
                  <div class="flex-1 h-1.5 rounded-full bg-white/15 overflow-hidden">
                    <div id="currentTaskProgressBar" class="h-full w-0 bg-gradient-to-r from-violet-300 to-emerald-300"></div>
                  </div>
                  <span id="currentTaskProgressLabel" class="text-[11px] tracking-[0.2em] text-slate-200/80">0%</span>
                </div>
              </div>
            </button>
            <div class="border-t border-white/5 px-4 py-3 text-[11px] uppercase tracking-[0.28em] text-center text-slate-400">
              Klikni pro detail briefingu
            </div>
          </section>

          <section class="rounded-2xl p-5 glass-panel space-y-4">
            <div class="flex items-center gap-2">
              <span class="text-lg">üß≠</span>
              <h3 class="text-sm font-semibold text-slate-100 uppercase tracking-[0.16em]">Lokace ve mƒõstƒõ</h3>
            </div>
            <div class="grid grid-cols-1 gap-2 text-sm">
              <button id="cityHubBtn" class="location-option">
                <span class="location-option__icon">üè°</span>
                <span class="location-option__label">√övod</span>
              </button>
              <button id="ticketToggleBtn" class="location-option">
                <span class="location-option__icon">üöâ</span>
                <span class="location-option__label">N√°dra≈æ√≠</span>
              </button>
              <button id="infoCenterBtn" class="location-option">
                <span class="location-option__icon">üèõÔ∏è</span>
                <span class="location-option__label">Informaƒçn√≠ centrum</span>
              </button>
              <button class="location-option">
                <span class="location-option__icon">üè¶</span>
                <span class="location-option__label">Banka</span>
              </button>
              <button class="location-option">
                <span class="location-option__icon">üß™</span>
                <span class="location-option__label">Laborato≈ô</span>
              </button>
              <button class="location-option">
                <span class="location-option__icon">üì£</span>
                <span class="location-option__label">Medi√°ln√≠ centrum</span>
              </button>
              <button class="location-option">
                <span class="location-option__icon">üõí</span>
                <span class="location-option__label">Trh</span>
              </button>
            </div>
          </section>
        </aside>
      </div>
    </div>

    <!-- Overlay pro animaci p≈ôesunu -->
    <div id="travelOverlay" class="fixed inset-0 bg-slate-950/90 backdrop-blur-sm hidden z-50 flex items-center justify-center px-4">
      <div class="travel-card glass-panel glass-panel--accent rounded-2xl relative overflow-visible w-[min(720px,90vw)] px-6 pt-24 pb-6">
        <div class="travel-top-row flex justify-between items-end">
          <div class="travel-top-info flex flex-col gap-1">
            <div class="travel-top-type text-lg font-bold text-slate-100" id="travelTopType">-</div>
            <div class="travel-top-speed text-sm text-slate-300" id="travelTopSpeed">-</div>
          </div>
          <div class="travel-train-wrap pointer-events-none absolute -top-16 right-2 opacity-95 rotate-[-2deg]">
            <img id="travelTrainImg" src="/static/assets/train_1.png" alt="Train" class="max-w-[440px] drop-shadow-[0_18px_22px_rgba(0,0,0,0.55)]" />
          </div>
        </div>

        <div class="travel-clock text-center text-5xl font-extrabold text-sky-100 mt-6 mb-3 leading-tight" id="travelClockLabel">-</div>
        <div class="travel-progress-header flex justify-between text-2xl text-slate-100 font-bold tracking-tight">
          <div id="travelProgressFrom" class="text-left">-</div>
          <div id="travelProgressTo" class="text-right">-</div>
        </div>
        <div class="travel-progress h-3 bg-slate-800 rounded-full overflow-hidden mt-2">
          <div id="travelProgressBar" class="travel-progress-bar h-full bg-gradient-to-r from-sky-400 via-slate-100 to-red-400 w-0"></div>
        </div>

        <div class="mt-6 grid grid-cols-2 gap-4 text-sm text-slate-200">
          <div>
            <div class="travel-label text-xs uppercase tracking-[0.12em] text-slate-400">Vzd√°lenost</div>
            <div class="travel-value text-base font-semibold" id="travelDistanceLabel">-</div>
          </div>
          <div>
            <div class="travel-label text-xs uppercase tracking-[0.12em] text-slate-400">ƒåas j√≠zdy</div>
            <div class="travel-value text-base font-semibold" id="travelDurationLabel">-</div>
          </div>
        </div>
      </div>
    </div>

    <!-- JS modul ‚Äì game logic -->
    <script type="module" src="{{ url_for('static', filename='js/game.js') }}"></script>
  </body>
</html>
