<!doctype html>
<html lang="cs">
  <head>
    <meta charset="utf-8" />
    <title>Agent USA ‚Äì mƒõstsk√© menu</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      :root {
        font-family: "Inter", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
        --accent-primary: #6366f1;
        --accent-primary-dark: #1f1d45;
        --accent-card: linear-gradient(150deg, rgba(99, 102, 241, 0.96), rgba(27, 24, 66, 0.98));
        --accent-border: rgba(165, 180, 252, 0.45);
        --accent-glow: rgba(129, 140, 248, 0.45);
        --surface-muted: rgba(7, 10, 26, 0.85);
      }

      body {
        margin: 0;
        min-height: 100vh;
        background: #030617;
        color: #f8fafc;
      }

      .city-stage {
        position: relative;
        min-height: 100vh;
        overflow: hidden;
        background: radial-gradient(circle at top, #12223f 0%, #030712 65%, #01030a 100%);
        width: 100%;
        margin: 0 auto;
      }

      #canvasBlock {
        position: absolute;
        inset: 0;
        pointer-events: none;
      }

      .city-cover {
        position: relative;
        width: 100%;
        height: 100%;
      }

      #cityBackdrop {
        width: 100%;
        height: 100%;
        object-fit: cover;
        filter: saturate(1.15) contrast(0.95);
        position: relative;
        z-index: 2;
      }

      #skyGradient,
      #nightOverlay,
      #daySunOverlay {
        position: absolute;
        inset: 0;
        pointer-events: none;
      }

      #skyGradient {
        background: linear-gradient(180deg, #3f7fd8 0%, #8fcfff 55%, #f4fbff 100%);
        z-index: 1;
        opacity: 1;
      }

      #nightOverlay {
        background: rgba(2, 6, 23, 0.65);
        opacity: 0;
        transition: opacity 0.4s ease;
        z-index: 3;
      }

      #daySunOverlay {
        background: radial-gradient(circle at 20% 20%, rgba(255, 196, 124, 0.35), transparent 55%);
        opacity: 0;
        transition: opacity 0.4s ease;
        mix-blend-mode: screen;
        z-index: 3;
      }

      #gameCanvas {
        position: absolute;
        inset: 0;
        width: 100%;
        height: 100%;
        opacity: 0;
      }

      .ui-layer {
        position: relative;
        z-index: 10;
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        padding: 1rem 1rem 6.5rem;
      }

      .top-bar,
      .location-bar {
        backdrop-filter: blur(26px);
        background: rgba(2, 6, 23, 0.4);
        border: 1px solid rgba(148, 163, 184, 0.25);
        box-shadow: 0 25px 60px rgba(3, 6, 18, 0.35);
      }

      .top-bar {
        border-radius: 32px;
      }

      #currentTimeLabel {
        font-variant-numeric: tabular-nums;
        font-feature-settings: "tnum";
      }

      .location-bar {
        border-radius: 0;
        border-left: 0;
        border-right: 0;
        border-bottom: 0;
        min-height: 64px;
      }

      .level-circle-wrapper {
        position: relative;
        display: inline-flex;
        align-items: center;
        justify-content: center;
      }

      .level-circle {
        height: 56px;
        width: 56px;
        border-radius: 9999px;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        gap: 0.18rem;
        font-weight: 700;
        background: linear-gradient(145deg, rgba(98, 33, 160, 0.9), rgba(33, 12, 56, 0.92));
        border: 1px solid rgba(248, 250, 252, 0.35);
        color: #fef2ff;
        box-shadow: 0 8px 18px rgba(60, 9, 90, 0.4);
        text-align: center;
        padding: 6px 6px 8px;
      }

      .xp-gain-badge {
        position: absolute;
        top: -6px;
        right: -6px;
        padding: 0.1rem 0.6rem;
        font-size: 0.6rem;
        letter-spacing: 0.18em;
        text-transform: uppercase;
        border-radius: 999px;
        border: 1px solid rgba(250, 204, 21, 0.65);
        background: radial-gradient(circle at 50% 0%, rgba(250, 204, 21, 0.35), rgba(12, 6, 22, 0.9));
        color: #fef3c7;
        opacity: 0;
        transform: translateY(-4px) scale(0.95);
        transition: opacity 0.2s ease, transform 0.3s ease;
        pointer-events: none;
      }

      .xp-gain-badge--visible {
        opacity: 1;
        transform: translateY(-18px) scale(1);
      }

      .level-circle__value {
        font-size: 1.2rem;
        line-height: 1;
      }

      .level-progress {
        width: 82%;
        height: 7px;
        border-radius: 999px;
        background: rgba(255, 255, 255, 0.25);
        overflow: hidden;
        margin-top: 2px;
        position: relative;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .level-progress__fill {
        position: absolute;
        inset: 0;
        width: 0%;
        background: linear-gradient(90deg, #f97316, #facc15);
        border-radius: inherit;
        transition: width 0.3s ease;
        z-index: 0;
      }

      .level-progress__label {
        position: absolute;
        inset: 0;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 0.52rem;
        letter-spacing: 0.08em;
        text-transform: uppercase;
        font-weight: 600;
        color: rgba(15, 23, 42, 0.9);
        pointer-events: none;
        z-index: 1;
      }

      .location-pill {
        position: relative;
        flex: 0 0 auto;
        height: 68px;
        width: 68px;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        border-radius: 16px;
        border: 1px solid var(--accent-border);
        background: var(--accent-card);
        color: rgba(247, 241, 255, 0.95);
        transition: transform 0.2s ease, box-shadow 0.2s ease;
        margin-top: -28px;
        box-shadow: 0 24px 52px rgba(10, 3, 25, 0.75);
      }

      .location-pill::before {
        content: "";
        position: absolute;
        inset: 2px;
        border-radius: inherit;
        background: radial-gradient(circle at 30% 20%, rgba(255, 255, 255, 0.3), transparent 60%);
        opacity: 0.7;
        pointer-events: none;
      }

      .location-pill.is-active {
        border-color: rgba(255, 255, 255, 0.75);
        box-shadow: 0 24px 45px rgba(76, 29, 149, 0.55);
      }

      .location-pill::after {
        content: attr(data-label);
        position: absolute;
        bottom: 115%;
        left: 50%;
        transform: translateX(-50%);
        padding: 0.18rem 0.6rem;
        border-radius: 9999px;
        background: rgba(6, 11, 26, 0.95);
        border: 1px solid rgba(148, 163, 184, 0.4);
        color: #f8fafc;
        font-size: 0.7rem;
        letter-spacing: 0.08em;
        text-transform: uppercase;
        opacity: 0;
        pointer-events: none;
        white-space: nowrap;
        transition: opacity 0.2s ease, transform 0.2s ease;
      }

      .location-pill:hover {
        transform: translateY(-4px) scale(1.06);
        box-shadow: 0 26px 45px rgba(76, 29, 149, 0.5);
      }

      .location-pill:hover::after {
        opacity: 1;
        transform: translate(-50%, -4px);
      }

      .location-pill__icon {
        width: 32px;
        height: 32px;
        position: relative;
        z-index: 1;
        stroke: rgba(248, 250, 252, 0.95);
        fill: none;
        stroke-width: 1.8;
        stroke-linecap: round;
        stroke-linejoin: round;
      }

      .location-pill__icon--solid {
        fill: rgba(248, 250, 252, 0.85);
        stroke: none;
      }

      .city-footer {
        position: fixed;
        left: 0;
        bottom: 0;
        width: 100%;
        z-index: 25;
        pointer-events: none;
      }

      .task-bar {
        position: fixed;
        right: 1.5rem;
        bottom: 90px;
        width: min(360px, 80vw);
        z-index: 30;
        pointer-events: none;
      }

      .task-card {
        pointer-events: auto;
        width: 100%;
        text-align: left;
        border-radius: 18px;
        border: 1px solid var(--accent-border);
        background: var(--accent-card);
        padding: 0.9rem 1rem;
        display: flex;
        flex-direction: column;
        gap: 0.4rem;
        box-shadow: 0 18px 45px rgba(5, 6, 20, 0.65);
        transition: transform 0.2s ease, box-shadow 0.2s ease;
        min-height: 115px;
        position: relative;
      }

      .task-card--intro-hidden {
        opacity: 0;
        transform: translateX(80px);
        pointer-events: none;
      }

      .task-card--intro-animating {
        animation: taskCardSlideIn 0.6s cubic-bezier(0.21, 0.78, 0.33, 1) forwards;
      }

      .task-card--exit-right {
        pointer-events: none;
        animation: taskCardExitRight 0.55s cubic-bezier(0.22, 0.78, 0.31, 1) forwards;
      }

      @keyframes taskCardSlideIn {
        0% {
          opacity: 0;
          transform: translateX(80px) scale(0.98);
        }
        65% {
          opacity: 1;
          transform: translateX(-6px) scale(1.01);
        }
        100% {
          opacity: 1;
          transform: translateX(0) scale(1);
        }
      }

      @keyframes taskCardExitRight {
        0% {
          opacity: 1;
          transform: translateX(0) scale(1);
        }
        100% {
          opacity: 0;
          transform: translateX(160px) scale(0.95);
        }
      }

      .task-card:hover {
        transform: translateY(-1px);
        box-shadow: 0 20px 36px rgba(2, 6, 23, 0.55);
      }

      .task-card__location {
        font-size: 0.58rem;
        letter-spacing: 0.25em;
        text-transform: uppercase;
        color: rgba(226, 232, 240, 0.85);
      }

      .task-card__location span {
        white-space: nowrap;
      }

      .task-card__reward-pill {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        padding: 0.2rem 0.7rem;
        border-radius: 999px;
        border: 1px solid rgba(255, 255, 255, 0.35);
        background: rgba(15, 23, 42, 0.38);
        font-size: 0.65rem;
        font-weight: 600;
        color: #fefce8;
        width: fit-content;
        box-shadow: inset 0 0 12px rgba(15, 23, 42, 0.25);
      }

      .task-card__title {
        font-size: 0.95rem;
        font-weight: 700;
        color: #f8fafc;
      }

      .task-card__summary {
        font-size: 0.75rem;
        color: rgba(248, 250, 252, 0.82);
      }

      .task-card__progress {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        font-size: 0.7rem;
        letter-spacing: 0.25em;
        text-transform: uppercase;
        color: rgba(148, 163, 184, 0.8);
      }

      .task-card__progress-bar {
        flex: 1;
        height: 4px;
        border-radius: 9999px;
        background: rgba(148, 163, 184, 0.25);
        overflow: hidden;
      }

      .task-card__progress-bar-fill {
        height: 100%;
        width: 0%;
        background: linear-gradient(90deg, #a855f7, #22d3ee);
      }

      .travel-card {
        width: min(620px, 88vw);
        pointer-events: auto;
        text-align: left;
        border-radius: 26px;
        padding: 1.5rem 1.5rem 1.4rem;
        position: relative;
        overflow: visible;
        background: radial-gradient(circle at 0% 0%, rgba(124, 58, 237, 0.15), transparent 55%),
          linear-gradient(165deg, rgba(10, 14, 28, 0.98), rgba(3, 6, 16, 0.96));
        border: 1px solid rgba(148, 163, 184, 0.12);
        box-shadow: 0 32px 65px rgba(2, 6, 23, 0.65);
        display: flex;
        flex-direction: column;
        gap: 1.1rem;
      }

      .travel-hero {
        display: flex;
        flex-wrap: wrap;
        align-items: center;
        gap: 1rem;
      }

      .travel-hero__train img {
        width: min(260px, 55vw);
        filter: drop-shadow(0 18px 26px rgba(0, 0, 0, 0.55));
      }

      .travel-hero__info {
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
        min-width: 200px;
      }

      .travel-line-stack {
        display: flex;
        flex-direction: column;
        gap: 0.4rem;
      }

      .travel-time {
        display: flex;
        flex-direction: column;
        gap: 0.2rem;
      }

      .travel-time strong {
        font-size: 2.4rem;
        color: #f8fafc;
        letter-spacing: 0.18em;
        font-variant-numeric: tabular-nums;
        font-feature-settings: "tnum";
        font-family: inherit;
        text-shadow: 0 6px 18px rgba(15, 23, 42, 0.55);
      }

      .travel-map-container {
        margin-top: 0.4rem;
      }

      .travel-map-frame {
        position: relative;
        border-radius: 26px;
        border: 1px solid rgba(148, 163, 184, 0.2);
        overflow: hidden;
        background: radial-gradient(circle at 20% 20%, rgba(56, 189, 248, 0.3), transparent 45%),
          radial-gradient(circle at 80% 0%, rgba(248, 113, 113, 0.25), transparent 40%),
          rgba(2, 6, 23, 0.9);
        box-shadow: inset 0 0 40px rgba(2, 6, 23, 0.55);
      }

      .travel-map-canvas {
        display: block;
        width: 100%;
        height: 340px;
      }

      .travel-stats-row {
        margin-top: 0.8rem;
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
        gap: 0.9rem;
      }

      .travel-stat-card {
        border-radius: 18px;
        padding: 0.85rem 1rem;
        border: 1px solid rgba(248, 250, 252, 0.08);
        background: rgba(2, 6, 23, 0.7);
        backdrop-filter: blur(10px);
      }

      .travel-stat-card span {
        display: block;
        font-size: 0.6rem;
        letter-spacing: 0.3em;
        text-transform: uppercase;
        color: rgba(226, 232, 240, 0.65);
      }

      .travel-stat-card strong {
        display: block;
        margin-top: 0.35rem;
        font-size: 1.1rem;
        font-weight: 600;
        color: #f8fafc;
      }

      .teleport-overlay {
        position: fixed;
        inset: 0;
        background: rgba(2, 6, 23, 0.8);
        backdrop-filter: blur(10px);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 60;
      }

      .teleport-panel {
        width: min(420px, 90vw);
        border-radius: 24px;
        border: 1px solid rgba(148, 163, 184, 0.2);
        background: rgba(10, 15, 30, 0.95);
        box-shadow: 0 30px 60px rgba(2, 6, 23, 0.65);
        padding: 1.8rem;
      }

      .teleport-panel label {
        display: block;
        font-size: 0.7rem;
        letter-spacing: 0.3em;
        text-transform: uppercase;
        color: rgba(148, 163, 184, 0.75);
        margin-bottom: 0.6rem;
      }

      .teleport-panel select {
        width: 100%;
        border-radius: 14px;
        border: 1px solid rgba(148, 163, 184, 0.2);
        background: rgba(15, 23, 42, 0.9);
        color: #f8fafc;
        padding: 0.6rem 0.8rem;
      }

      .teleport-panel button {
        border-radius: 999px;
        padding: 0.55rem 1.1rem;
        font-size: 0.75rem;
        letter-spacing: 0.2em;
        text-transform: uppercase;
      }

      .travel-eyebrow {
        font-size: 0.62rem;
        letter-spacing: 0.35em;
        text-transform: uppercase;
        color: rgba(226, 232, 240, 0.75);
      }

      .travel-line-chip {
        display: inline-flex;
        align-items: center;
        gap: 0.4rem;
        padding: 0.35rem 0.85rem;
        border-radius: 999px;
        border: 1px solid rgba(248, 250, 252, 0.2);
        background: rgba(15, 23, 42, 0.35);
        font-size: 0.75rem;
        font-weight: 600;
        color: #f8fafc;
      }

      .travel-clock-card {
        border-radius: 24px;
        padding: 0;
        background: transparent;
        display: flex;
        flex-direction: column;
        gap: 0.35rem;
        min-width: 240px;
      }

      .travel-clock-card span {
        font-size: 0.65rem;
        letter-spacing: 0.32em;
        text-transform: uppercase;
        color: rgba(148, 163, 184, 0.85);
      }

      .travel-clock-card strong {
        font-size: 2.4rem;
        color: #e0f2fe;
        letter-spacing: 0.2em;
        font-variant-numeric: tabular-nums;
        font-feature-settings: "tnum";
        font-family: "JetBrains Mono", "Fira Code", "Roboto Mono", monospace;
      }

      .task-card--celebrating {
        animation: taskCardPulse 0.8s ease-in-out alternate 4;
        border-color: rgba(251, 191, 36, 0.75);
        box-shadow:
          0 0 18px rgba(251, 191, 36, 0.35),
          0 18px 38px rgba(3, 6, 18, 0.65);
      }

      @keyframes taskCardPulse {
        from {
          transform: translateY(0);
        }
        to {
          transform: translateY(-2px) scale(1.01);
        }
      }

      .location-bar {
        pointer-events: auto;
        width: 100%;
        padding: 0.5rem 1.5rem 0.7rem;
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 1.25rem;
        max-width: 100%;
        background: rgba(7, 6, 18, 0.4);
      }

      .footer-content {
        width: 100%;
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 1rem;
      }

      .location-grid {
        display: flex;
        flex-wrap: nowrap;
        gap: 0.65rem;
        align-items: flex-end;
      }

      .footer-resources {
        display: flex;
        align-items: center;
        gap: 0.6rem;
        flex-wrap: wrap;
        justify-content: flex-end;
      }

      .energy-meter {
        display: flex;
        align-items: center;
        gap: 0.4rem;
        padding: 0.25rem 0.85rem;
        border-radius: 999px;
        border: 1px solid rgba(250, 204, 21, 0.45);
        background: rgba(23, 15, 34, 0.8);
        box-shadow: inset 0 0 18px rgba(250, 204, 21, 0.15);
      }

      .energy-meter__label {
        font-size: 0.58rem;
        letter-spacing: 0.2em;
        text-transform: uppercase;
        color: rgba(248, 250, 252, 0.8);
      }

      .energy-meter__bar {
        height: 6px;
        width: 140px;
        border-radius: 9999px;
        background: rgba(248, 250, 252, 0.08);
        overflow: hidden;
        position: relative;
      }

      .energy-meter__bar-fill {
        position: absolute;
        inset: 0;
        background: linear-gradient(90deg, #fb923c, #facc15);
        box-shadow: 0 0 12px rgba(250, 204, 21, 0.45);
        width: 0;
      }

      .energy-meter__value {
        font-size: 0.72rem;
        letter-spacing: 0.18em;
        text-transform: uppercase;
        color: #fef9c3;
      }

      .resource-pill {
        display: inline-flex;
        align-items: center;
        gap: 0.35rem;
        padding: 0.32rem 0.85rem;
        border-radius: 9999px;
        border: 1px solid rgba(148, 163, 184, 0.35);
        background: var(--surface-muted);
        font-size: 0.78rem;
        font-weight: 600;
        box-shadow: inset 0 0 18px rgba(15, 23, 42, 0.4);
      }

      .resource-pill__icon {
        width: 1.4rem;
        height: 1.4rem;
        border-radius: 999px;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        font-size: 0.9rem;
        background: rgba(255, 255, 255, 0.08);
        box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.25);
      }

      .resource-pill__value {
        letter-spacing: 0.1em;
        text-transform: uppercase;
        font-size: 0.72rem;
        color: rgba(248, 250, 252, 0.85);
      }

      .resource-pill--data {
        border-color: rgba(45, 212, 191, 0.55);
        box-shadow: inset 0 0 18px rgba(45, 212, 191, 0.15);
      }

      .resource-pill--material {
        border-color: rgba(251, 191, 36, 0.55);
        box-shadow: inset 0 0 18px rgba(251, 191, 36, 0.15);
      }

      .resource-pill--credits {
        border-color: rgba(190, 242, 100, 0.55);
        box-shadow: inset 0 0 18px rgba(190, 242, 100, 0.15);
      }

      @media (max-width: 900px) {
        .location-bar {
          flex-direction: column;
          align-items: stretch;
          gap: 0.75rem;
          padding: 0.6rem 1rem 0.9rem;
        }
        .footer-content {
          flex-direction: column;
          align-items: stretch;
          gap: 0.75rem;
        }
        .location-grid {
          justify-content: flex-start;
          flex-wrap: wrap;
        }
        .location-pill {
          flex: 1 1 45%;
          height: 60px;
          width: 100%;
          margin-top: -10px;
        }
        .footer-resources {
          justify-content: flex-start;
          flex-wrap: wrap;
        }
      }

      .panel-card {
        position: fixed;
        left: 50%;
        top: 50%;
        transform: translate(-50%, -50%);
        width: min(720px, 92vw);
        background: rgba(2, 6, 23, 0.96);
        border: 1px solid rgba(148, 163, 184, 0.25);
        border-radius: 24px;
        box-shadow: 0 30px 90px rgba(3, 6, 18, 0.55);
        backdrop-filter: blur(28px);
        padding: 1.75rem;
        z-index: 20;
      }

      #taskDetailPanel.panel-card {
        background: rgba(5, 10, 24, 0.82);
        border-radius: 20px;
        border: 1px solid rgba(148, 163, 184, 0.18);
        box-shadow: 0 20px 60px rgba(2, 6, 23, 0.55);
        padding: 1.4rem 1.6rem;
      }

      .lab-action-btn[disabled] {
        opacity: 0.45;
        cursor: not-allowed;
      }

      .lab-hero {
        background: linear-gradient(135deg, rgba(17, 94, 89, 0.75), rgba(14, 165, 233, 0.15), rgba(88, 28, 135, 0.45));
        border: 1px solid rgba(148, 163, 184, 0.32);
        box-shadow: 0 25px 60px rgba(2, 6, 23, 0.65);
      }
      .lab-chip {
        border-radius: 999px;
        padding: 0.15rem 0.75rem;
        font-size: 0.65rem;
        letter-spacing: 0.2em;
        text-transform: uppercase;
      }
      .lab-meta-grid {
        display: grid;
        gap: 0.75rem;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        width: 100%;
      }
      .lab-stat-chip {
        border-radius: 1rem;
        border: 1px solid rgba(255, 255, 255, 0.08);
        background: rgba(2, 6, 23, 0.55);
        padding: 1rem;
        min-height: 90px;
      }
      .lab-stat-chip__label {
        font-size: 0.68rem;
        letter-spacing: 0.2em;
        text-transform: uppercase;
        color: rgba(226, 232, 240, 0.7);
      }
      .lab-gauge {
        position: relative;
        height: 8px;
        border-radius: 999px;
        overflow: hidden;
        background: rgba(15, 23, 42, 0.55);
      }
      .lab-gauge__fill {
        position: absolute;
        inset: 0;
        width: 30%;
        border-radius: inherit;
        background: linear-gradient(90deg, #f59e0b, #e11d48);
      }
      .lab-section-card {
        border-radius: 1.5rem;
        border: 1px solid rgba(148, 163, 184, 0.2);
        background: rgba(2, 6, 23, 0.7);
        box-shadow: 0 20px 40px rgba(2, 6, 23, 0.45);
      }

      #timetableCard {
        left: 4%;
        right: auto;
        top: 50%;
        bottom: auto;
        transform: translate(0, -50%);
        width: 75%;
        max-width: 960px;
      }

      #cityInfoPanel {
        left: 4%;
        right: auto;
        top: 50%;
        bottom: auto;
        transform: translate(0, -50%);
        width: 75%;
        max-width: 960px;
      }

      #labPanel {
        left: 4%;
        right: auto;
        top: 50%;
        bottom: auto;
        transform: translate(0, -50%);
        width: 75%;
        max-width: 960px;
      }

      #workshopPanel {
        left: 4%;
        right: auto;
        top: 50%;
        bottom: auto;
        transform: translate(0, -50%);
        width: 75%;
        max-width: 960px;
      }

      .lab-story-launch {
        border-radius: 999px;
        padding: 0.5rem 1.25rem;
        font-size: 0.8rem;
        text-transform: uppercase;
        letter-spacing: 0.25em;
        border: 1px solid rgba(248, 250, 252, 0.2);
        color: #f8fafc;
        background: rgba(251, 191, 36, 0.08);
        backdrop-filter: blur(6px);
        transition: background 0.2s ease, transform 0.2s ease;
      }

      .lab-story-launch:hover {
        background: rgba(251, 191, 36, 0.2);
        transform: translateY(-1px);
      }

      #labStoryNotice {
        position: fixed;
        inset: 0;
        background: rgba(2, 6, 23, 0.85);
        backdrop-filter: blur(18px);
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 1.5rem;
        z-index: 60;
      }

      #labStoryNotice.hidden {
        display: none;
      }

      .lab-story-dialog {
        width: min(640px, 100%);
        border-radius: 1.75rem;
        border: 1px solid rgba(248, 250, 252, 0.08);
        background: linear-gradient(140deg, rgba(23, 37, 84, 0.95), rgba(15, 23, 42, 0.9));
        box-shadow: 0 35px 80px rgba(2, 6, 23, 0.7);
        padding: 2rem;
      }

      .lab-story-header {
        display: flex;
        flex-direction: column;
        gap: 1.25rem;
      }

      @media (min-width: 640px) {
        .lab-story-header {
          flex-direction: row;
          align-items: flex-start;
          justify-content: space-between;
        }
      }

      .lab-story-figure {
        display: flex;
        flex-direction: column;
        gap: 1rem;
        flex: 1;
      }

      @media (min-width: 640px) {
        .lab-story-figure {
          flex-direction: row;
          align-items: flex-start;
        }
      }

      .lab-story-eyebrow {
        font-size: 0.7rem;
        letter-spacing: 0.35em;
        text-transform: uppercase;
        color: rgba(224, 231, 255, 0.6);
        margin-bottom: 0.4rem;
      }

      #labStoryTitle {
        font-size: 1.4rem;
        font-weight: 700;
        margin: 0;
        color: #f8fafc;
      }

      #labStoryBody {
        font-size: 0.95rem;
        line-height: 1.7;
        color: rgba(226, 232, 240, 0.9);
        white-space: pre-line;
        margin: 0.75rem 0 1.25rem;
      }

      .lab-story-meta {
        display: flex;
        align-items: center;
        gap: 1rem;
        padding: 1rem;
        border-radius: 1.25rem;
        background: rgba(15, 23, 42, 0.75);
        border: 1px solid rgba(226, 232, 240, 0.08);
      }

      .lab-story-portrait {
        width: 96px;
        height: 96px;
        border-radius: 28px;
        background: radial-gradient(circle at 20% 20%, rgba(251, 191, 36, 0.35), rgba(37, 99, 235, 0.25));
        padding: 0.4rem;
        border: 1px solid rgba(226, 232, 240, 0.2);
        box-shadow: 0 20px 40px rgba(15, 23, 42, 0.7);
        flex-shrink: 0;
      }

      .lab-story-portrait img {
        width: 100%;
        height: 100%;
        display: block;
        object-fit: cover;
        border-radius: inherit;
      }

      .lab-story-bubble {
        position: relative;
        flex: 1;
        border-radius: 1.5rem;
        border: 1px solid rgba(148, 163, 184, 0.35);
        padding: 1.2rem 1.4rem 1.4rem;
        background: linear-gradient(165deg, rgba(30, 58, 138, 0.85), rgba(15, 23, 42, 0.95));
        box-shadow: 0 30px 60px rgba(2, 6, 23, 0.65);
      }

      .lab-story-bubble::after {
        content: "";
        position: absolute;
        left: -16px;
        top: 45%;
        width: 24px;
        height: 24px;
        background: inherit;
        border-left: 1px solid rgba(148, 163, 184, 0.35);
        border-bottom: 1px solid rgba(148, 163, 184, 0.35);
        transform: translateY(-50%) rotate(45deg);
        border-bottom-left-radius: 0.6rem;
      }

      @media (max-width: 639px) {
        .lab-story-bubble::after {
          display: none;
        }
      }

      .lab-story-actions {
        display: flex;
        flex-wrap: wrap;
        gap: 0.75rem;
        align-items: center;
      }

      .lab-story-close {
        border-radius: 999px;
        padding: 0.5rem 1.1rem;
        border: 1px solid rgba(248, 250, 252, 0.2);
        color: #e2e8f0;
        background: transparent;
        text-transform: uppercase;
        letter-spacing: 0.25em;
        font-size: 0.65rem;
      }

      .lab-story-close:hover {
        background: rgba(248, 250, 252, 0.1);
      }

      .lab-story-confirm {
        display: inline-flex;
        align-items: center;
        gap: 0.4rem;
        border-radius: 1rem;
        background: linear-gradient(145deg, rgba(56, 189, 248, 0.92), rgba(129, 140, 248, 0.95));
        color: #e2e8f0;
        font-weight: 600;
        padding: 0.65rem 1.6rem;
        border: 1px solid rgba(148, 163, 184, 0.4);
        box-shadow: 0 14px 32px rgba(14, 116, 144, 0.35);
        letter-spacing: 0.15em;
        text-transform: uppercase;
        cursor: pointer;
      }

      .lab-story-confirm:disabled {
        opacity: 0.45;
        cursor: not-allowed;
      }

      .lab-story-confirm:focus-visible {
        outline: 2px solid rgba(251, 191, 36, 0.9);
        outline-offset: 3px;
      }

      #taskDetailPanel {
        left: 4%;
        right: auto;
        top: 50%;
        bottom: auto;
        transform: translate(0, -50%);
        width: 75%;
        max-width: 960px;
      }

      .task-card__priority-dot {
        position: absolute;
        top: 0.45rem;
        right: 0.45rem;
        width: 12px;
        height: 12px;
        border-radius: 50%;
        background: radial-gradient(circle, #fff 0%, #f59e0b 45%, #f97316 100%);
        box-shadow: 0 0 14px rgba(249, 115, 22, 0.8);
        cursor: help;
      }

      .task-detail-chip {
        display: inline-flex;
        align-items: center;
        gap: 0.25rem;
        border-radius: 999px;
        border: 1px solid rgba(148, 163, 184, 0.25);
        padding: 0.25rem 0.75rem;
        font-size: 0.65rem;
        letter-spacing: 0.18em;
        text-transform: uppercase;
        color: rgba(248, 250, 252, 0.75);
        background: rgba(15, 23, 42, 0.35);
      }

      .task-detail-desc {
        font-size: 0.9rem;
        line-height: 1.6;
        color: rgba(226, 232, 240, 0.88);
      }

      .task-detail-pill {
        border-radius: 12px;
        border: 1px solid rgba(148, 163, 184, 0.2);
        padding: 0.65rem 0.9rem;
        background: rgba(15, 23, 42, 0.35);
      }

      #cityInfoMapWrapper {
        width: 100%;
        max-width: 520px;
      }

      #timetableCard table {
        font-size: 0.72rem;
      }

      #timetableCard thead {
        font-size: 0.62rem;
      }

      #timetableCard tbody td {
        line-height: 1.15;
        padding-top: 0.35rem;
        padding-bottom: 0.35rem;
      }

      .panel-card table {
        width: 100%;
        border-collapse: collapse;
      }

      .panel-card th,
      .panel-card td {
        padding: 0.5rem 0.75rem;
      }

      .panel-card thead {
        text-transform: uppercase;
        letter-spacing: 0.1em;
        font-size: 0.65rem;
        color: rgba(226, 232, 240, 0.75);
      }

      .panel-card tbody td {
        border-top: 1px solid rgba(148, 163, 184, 0.2);
        font-size: 0.85rem;
      }

      .timetable-raised {
        transform: translate(-50%, -55%);
      }

      @media (max-width: 640px) {
        .top-bar,
        .location-bar {
          border-radius: 24px;
        }
        .level-circle {
          height: 56px;
          width: 56px;
          font-size: 1.2rem;
        }
        .location-pill {
          flex: 1 1 100%;
        }
      }
    </style>
  </head>
  <body>
    <div class="city-stage">
      <div id="canvasBlock">
        <div class="city-cover">
          <div id="skyGradient"></div>
          <img id="cityBackdrop" src="" alt="Panorama mƒõsta" onerror="this.classList.add('opacity-0');" />
          <div id="nightOverlay"></div>
          <div id="daySunOverlay"></div>
          <canvas id="gameCanvas" width="1024" height="576"></canvas>
        </div>
      </div>

      <div class="ui-layer">
        <header class="flex justify-center">
          <div class="top-bar w-full max-w-4xl px-4 py-3">
            <div class="flex flex-wrap items-center justify-between gap-3 text-slate-100/90">
              <div>
                <h1 id="currentCityName" class="text-lg font-semibold">-</h1>
                <p id="currentCityState" class="text-xs uppercase tracking-[0.25em] text-slate-300">-</p>
              </div>
              <div class="flex items-center gap-4">
                <div class="text-right leading-tight">
                  <p class="text-[10px] uppercase tracking-[0.35em] text-slate-400" id="currentWeekLabel">T√Ωden 1</p>
                  <p id="currentTimeLabel" class="text-xl font-semibold tracking-[0.2em] text-slate-100">
                    Po 08:00
                  </p>
                </div>
                <div class="level-circle-wrapper">
                  <div class="level-circle">
                    <span class="level-circle__value" id="agentLevel">1</span>
                    <div class="level-progress" aria-live="polite">
                      <div class="level-progress__fill" id="agentLevelProgress"></div>
                      <span class="level-progress__label" id="agentXpToNext">100 XP</span>
                    </div>
                  </div>
                  <div id="xpGainBadge" class="xp-gain-badge" aria-live="polite" aria-hidden="true">
                    +0 XP
                  </div>
                </div>
                <button
                  id="teleportTesterBtn"
                  type="button"
                  class="px-3 py-2 text-[10px] uppercase tracking-[0.3em] border border-white/20 text-slate-100/80 rounded-full hover:bg-white/10 transition"
                >
                  Test
                </button>
                <button
                  id="restartButton"
                  type="button"
                  class="h-10 w-10 flex items-center justify-center rounded-full border border-white/25 text-xs uppercase tracking-[0.25em] text-slate-100/80 hover:bg-white/10 transition"
                  title="Restartovat rozhran√≠"
                  aria-label="Restartovat rozhran√≠"
                >
                  ‚Üª
                </button>
              </div>
            </div>
          </div>
        </header>

      </div>

      <div id="taskDetailPanel" class="panel-card hidden">
        <div class="flex flex-wrap items-start justify-between gap-4 mb-5">
          <div>
            <p class="text-[11px] uppercase tracking-[0.3em] text-slate-400">Operaƒçn√≠ briefing</p>
            <h3 id="taskDetailTitle" class="text-xl font-semibold">Vyber √∫kol</h3>
            <p id="taskDetailSubtitle" class="text-sm text-slate-300">Klikni na jednu z lokac√≠ a p≈ôiprav pl√°n.</p>
          </div>
          <button
            id="closeTaskDetailBtn"
            type="button"
            class="text-xs uppercase tracking-[0.3em] text-slate-200 border border-white/20 rounded-full px-4 py-2"
          >
            Zpƒõt
          </button>
        </div>
        <div class="grid gap-5 lg:grid-cols-[220px_1fr]">
          <div id="taskListContainer" class="space-y-3 text-sm text-slate-200">
            <p>≈Ω√°dn√© aktivn√≠ √∫koly.</p>
          </div>
          <div class="space-y-5">
            <div class="flex flex-wrap items-center gap-2 text-sm text-slate-300">
              <span class="task-detail-chip" id="taskDetailLocation">---</span>
              <span class="task-detail-chip">Priorita: <span id="taskDetailPriority" class="text-slate-50 font-semibold ml-1">-</span></span>
              <span class="task-detail-chip">ETA: <span id="taskDetailEta" class="text-slate-50 font-semibold ml-1">-</span></span>
            </div>
            <p id="taskDetailDesc" class="task-detail-desc">
              Vyber √∫kol z nab√≠dky vlevo a zobraz√≠ se ti kompletn√≠ podklady.
            </p>
            <div>
              <div class="flex items-center justify-between mb-2">
                <p class="text-[11px] uppercase tracking-[0.3em] text-slate-400">Kroky operace</p>
                <span class="text-[10px] uppercase tracking-[0.3em] text-slate-400">XP po dokonƒçen√≠</span>
              </div>
              <ul id="taskObjectiveList" class="space-y-2 text-sm text-slate-100">
                <li class="text-slate-400">≈Ω√°dn√Ω √∫kol nen√≠ aktivn√≠.</li>
              </ul>
            </div>
            <div class="grid sm:grid-cols-2 gap-4 text-sm">
              <div class="task-detail-pill">
                <p class="text-[10px] uppercase tracking-[0.3em] text-emerald-200/80">Odmƒõna</p>
                <p id="taskRewardLabel" class="text-base font-semibold text-emerald-100">-</p>
              </div>
              <div class="task-detail-pill">
                <p class="text-[10px] uppercase tracking-[0.3em] text-slate-200/80">Status</p>
                <p id="taskStatusLabel" class="text-base font-semibold text-slate-100">-</p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div id="cityInfoPanel" class="panel-card hidden">
        <div class="flex flex-col gap-6 lg:flex-row lg:items-center">
          <div class="flex-1 space-y-4">
            <div class="flex items-center justify-between">
              <div>
                <p class="text-[11px] uppercase tracking-[0.3em] text-amber-200/70">Informaƒçn√≠ centrum</p>
                <h3 id="cityInfoName" class="text-lg font-semibold">-</h3>
                <p id="cityInfoMeta" class="text-sm text-slate-300">Vyber mƒõsto na mapƒõ</p>
                <p id="cityInfoPopulation" class="text-sm font-semibold text-amber-200">Poƒçet obyvatel: -</p>
              </div>
            </div>
            <p id="cityInfoDesc" class="text-xs leading-relaxed text-slate-200 whitespace-pre-line">
              P≈ôepni na mƒõsto a uk√°≈æeme ti detaily.
            </p>
            <div id="cityInfoDetails" class="space-y-3 text-sm text-slate-200">
              <!-- Budouc√≠ dopl≈àuj√≠c√≠ informace -->
            </div>
          </div>
          <div
            id="cityInfoMapWrapper"
            class="rounded-2xl overflow-hidden relative max-w-[520px] w-full lg:w-auto"
          >
            <canvas
              id="cityInfoMap"
              width="520"
              height="300"
              class="block max-w-full"
              aria-label="Mapa mƒõsta a p≈ôilehl√Ωch tras"
            ></canvas>
            <div
              id="cityInfoMapTooltip"
              class="absolute pointer-events-none px-2 py-1 rounded-md text-[11px] tracking-wide uppercase bg-slate-900/90 border border-white/20 text-slate-100 shadow-lg hidden"
            ></div>
          </div>
        </div>
      </div>

      <div id="labPanel" class="panel-card hidden space-y-5">
        <div class="lab-hero rounded-3xl p-5 flex flex-col gap-5">
          <div class="flex flex-col gap-3 sm:flex-row sm:items-start sm:justify-between">
            <div>
              <p class="lab-chip bg-emerald-200/15 text-emerald-200">Laborato≈ô</p>
              <h3 class="text-2xl font-semibold text-white mt-2">Centrum bio-anal√Ωz</h3>
              <p class="text-sm text-slate-200/90">≈Ωiv√© p≈ôehledy senzor≈Ø a rychl√© z√°sahy proti mlze.</p>
            </div>
            <div class="flex items-center gap-3">
              <button
                id="labStoryLaunchBtn"
                type="button"
                class="lab-story-launch hidden"
                aria-haspopup="dialog"
              >
                Br√≠fink Dr. Rooka
              </button>
              <div class="text-3xl sm:text-4xl" aria-hidden="true">üß™</div>
            </div>
          </div>
          <div class="lab-meta-grid">
            <div class="lab-stat-chip space-y-3">
              <div class="flex items-center justify-between gap-3">
                <p class="lab-stat-chip__label">√örove≈à ≈°√≠≈ôen√≠</p>
                <span class="text-[10px] uppercase tracking-[0.3em] text-slate-400">Telemetrie</span>
              </div>
              <div class="flex items-center gap-4">
                <div>
                  <p id="labFogLevelLabel" class="text-3xl font-bold text-amber-200">-</p>
                  <p id="labFogLevelDesc" class="text-xs text-slate-300">-</p>
                </div>
                <div class="flex-1 space-y-2">
                  <div class="lab-gauge">
                    <div id="labFogLevelBar" class="lab-gauge__fill"></div>
                  </div>
                  <p class="text-[10px] uppercase tracking-[0.3em] text-slate-400">Rychlost postupu</p>
                </div>
              </div>
            </div>
            <div class="lab-stat-chip space-y-2">
              <p class="lab-stat-chip__label">Senzorick√° data</p>
              <p class="text-2xl font-semibold text-sky-100">+</p>
              <p class="text-xs text-slate-300">Aktualizace ka≈æd√Ωch 15 min</p>
            </div>
            <div class="lab-stat-chip space-y-2">
              <p class="lab-stat-chip__label">Vzorky ve frontƒõ</p>
              <p class="text-2xl font-semibold text-rose-100">4</p>
              <p class="text-xs text-slate-300">ƒåekaj√≠ na anal√Ωzu</p>
            </div>
          </div>
        </div>

        <div class="grid gap-4 lg:grid-cols-2">
          <section class="lab-section-card space-y-3">
            <div class="flex items-center justify-between">
              <p class="text-sm font-semibold text-slate-100">Analytick√© re≈æimy</p>
              <span class="text-[10px] uppercase tracking-[0.3em] text-slate-400">Skeny</span>
            </div>
            <div class="grid gap-2 sm:grid-cols-2">
              <button type="button" class="lab-action-btn rounded-2xl border border-sky-400/40 bg-gradient-to-br from-sky-500/10 to-emerald-500/10 px-4 py-3 text-left hover:from-sky-500/20 hover:to-emerald-500/20 transition" data-action-code="fog_analysis">
                <div class="flex items-center gap-2">
                  <span class="text-xl">üî¨</span>
                  <div class="flex-1">
                    <p class="text-sm font-semibold text-slate-100">Anal√Ωza mlhy</p>
                    <p class="text-xs text-slate-300">Rozklad ƒç√°stic, hustota</p>
                  </div>
                </div>
                <p class="text-[11px] mt-3 text-slate-400">Status: <span class="text-amber-200 hidden" data-action-status></span></p>
              </button>
              <button type="button" class="lab-action-btn rounded-2xl border border-violet-400/40 bg-gradient-to-br from-purple-500/10 to-pink-500/10 px-4 py-3 text-left hover:from-purple-500/20 hover:to-pink-500/20 transition" data-action-code="direction_detection">
                <div class="flex items-center gap-2">
                  <span class="text-xl">üß≠</span>
                  <div class="flex-1">
                    <p class="text-sm font-semibold text-slate-100">Detekce smƒõru</p>
                    <p class="text-xs text-slate-300">Predictivn√≠ model ≈°√≠≈ôen√≠</p>
                  </div>
                </div>
                <p class="text-[11px] mt-3 text-slate-400">Status: <span class="text-amber-200 hidden" data-action-status></span></p>
              </button>
            </div>
          </section>

          <section class="lab-section-card space-y-3">
            <div class="flex items-center justify-between">
              <p class="text-sm font-semibold text-slate-100">Taktick√© z√°sahy</p>
              <span class="text-[10px] uppercase tracking-[0.3em] text-slate-400">Deploymenty</span>
            </div>
            <div class="grid gap-2 sm:grid-cols-3">
              <button type="button" class="lab-action-btn rounded-2xl border border-amber-400/40 bg-gradient-to-br from-amber-500/10 to-orange-500/10 px-3 py-3 text-left hover:from-amber-500/20 hover:to-orange-500/20 transition" data-action-code="slow_spread">
                <div class="flex items-center justify-between gap-2">
                  <span class="text-lg">üåÄ</span>
                  <span class="text-[10px] uppercase tracking-[0.25em] text-amber-100 hidden" data-action-status></span>
                </div>
                <p class="text-sm font-semibold text-slate-100 mt-2">Zpomalen√≠ ≈°√≠≈ôen√≠</p>
                <p class="text-xs text-slate-300">Tlumen√≠ expanze</p>
              </button>
              <button type="button" class="lab-action-btn rounded-2xl border border-emerald-400/40 bg-gradient-to-br from-emerald-500/10 to-teal-500/10 px-3 py-3 text-left hover:from-emerald-500/20 hover:to-teal-500/20 transition" data-action-code="local_filter">
                <div class="flex items-center justify-between gap-2">
                  <span class="text-lg">üõ°Ô∏è</span>
                  <span class="text-[10px] uppercase tracking-[0.25em] text-amber-100 hidden" data-action-status></span>
                </div>
                <p class="text-sm font-semibold text-slate-100 mt-2">Lok√°ln√≠ filtr</p>
                <p class="text-xs text-slate-300">Stabilizace mƒõsta</p>
              </button>
              <button type="button" class="lab-action-btn rounded-2xl border border-rose-400/40 bg-gradient-to-br from-rose-500/10 to-red-500/10 px-3 py-3 text-left hover:from-rose-500/20 hover:to-red-500/20 transition" data-action-code="local_serum">
                <div class="flex items-center justify-between gap-2">
                  <span class="text-lg">üíâ</span>
                  <span class="text-[10px] uppercase tracking-[0.25em] text-amber-100 hidden" data-action-status></span>
                </div>
                <p class="text-sm font-semibold text-slate-100 mt-2">Lok√°ln√≠ s√©rum</p>
                <p class="text-xs text-slate-300">Neutralizace lo≈æisek</p>
              </button>
            </div>
          </section>
        </div>
      </div>

      <div id="workshopPanel" class="panel-card hidden space-y-6">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-[11px] uppercase tracking-[0.3em] text-orange-200/70">D√≠lna</p>
            <h3 class="text-lg font-semibold text-slate-50">V√Ωroba prototyp≈Ø</h3>
            <p class="text-sm text-slate-300">Spravuj pl√°ny, materi√°l a provoz modularn√≠ch stanic.</p>
          </div>
          <span class="text-3xl" aria-hidden="true">üõ†Ô∏è</span>
        </div>

        <section class="space-y-3">
          <div>
            <p class="text-[11px] uppercase tracking-[0.3em] text-slate-400">1) Z√°kladn√≠ parametry</p>
            <h4 class="text-base font-semibold text-slate-100">Stav d√≠lny</h4>
          </div>
          <div class="grid gap-3 sm:grid-cols-3 text-sm text-slate-200">
            <div class="rounded-2xl border border-white/10 bg-slate-900/70 p-4">
              <p class="text-[10px] uppercase tracking-[0.3em] text-slate-400">√örove≈à</p>
              <p id="workshopLevelLabel" class="text-2xl font-bold text-white">-</p>
            </div>
            <div class="rounded-2xl border border-white/10 bg-slate-900/70 p-4">
              <p class="text-[10px] uppercase tracking-[0.3em] text-slate-400">Kapacity</p>
              <p id="workshopCapacityLabel" class="text-2xl font-bold text-amber-200">-</p>
            </div>
            <div class="rounded-2xl border border-white/10 bg-slate-900/70 p-4">
              <p class="text-[10px] uppercase tracking-[0.3em] text-slate-400">Aktivn√≠ v√Ωroby</p>
              <p id="workshopQueueLabel" class="text-2xl font-bold text-emerald-200">-</p>
            </div>
          </div>
        </section>

        <section class="space-y-3">
          <div>
            <p class="text-[11px] uppercase tracking-[0.3em] text-slate-400">2) Blueprinty</p>
            <h4 class="text-base font-semibold text-slate-100">Dostupn√© recepty</h4>
          </div>
          <div class="rounded-2xl border border-slate-800 bg-slate-900/70 divide-y divide-slate-800" id="workshopBlueprintList">
            <div class="p-4 text-sm text-slate-300">Zat√≠m ≈æ√°dn√© pl√°ny.</div>
          </div>
        </section>

        <section class="space-y-3">
          <div>
            <p class="text-[11px] uppercase tracking-[0.3em] text-slate-400">3) V√Ωroba</p>
            <h4 class="text-base font-semibold text-slate-100">Akce d√≠lny</h4>
          </div>
          <div class="grid gap-3 sm:grid-cols-3" id="workshopActionGrid">
            <button type="button" class="rounded-2xl border border-amber-500/30 bg-amber-500/10 px-3 py-4 text-left text-sm text-slate-100 hover:bg-amber-500/20 transition" disabled>
              <p class="font-semibold">Vyber blueprint</p>
              <p class="text-xs text-slate-300">Najdi pl√°n a spus≈• v√Ωrobn√≠ linku.</p>
            </button>
            <button type="button" class="rounded-2xl border border-emerald-500/30 bg-emerald-500/10 px-3 py-4 text-left text-sm text-slate-100 hover:bg-emerald-500/20 transition" disabled>
              <p class="font-semibold">Spr√°va fronty</p>
              <p class="text-xs text-slate-300">Zde se objev√≠ aktivn√≠ projekty.</p>
            </button>
            <button type="button" class="rounded-2xl border border-sky-500/30 bg-sky-500/10 px-3 py-4 text-left text-sm text-slate-100 hover:bg-sky-500/20 transition" disabled>
              <p class="font-semibold">Upgrade d√≠lny</p>
              <p class="text-xs text-slate-300">Odemkni dal≈°√≠ sloty pro v√Ωrobu.</p>
            </button>
          </div>
        </section>
      </div>

      <div id="timetableCard" class="panel-card hidden space-y-4">
        <div class="flex items-center gap-3">
          <span class="text-2xl">üöâ</span>
          <div>
            <p class="text-[11px] uppercase tracking-[0.3em] text-slate-400">J√≠zdn√≠ ≈ô√°d</p>
            <h3 class="text-lg font-semibold text-slate-100">Odjezdy</h3>
          </div>
        </div>
        <div class="overflow-x-auto rounded-2xl border border-white/10 bg-slate-950/40">
          <table id="timetableTable" class="tabular-nums">
            <thead>
              <tr>
                <th class="text-left">üïí Odjezd</th>
                <th class="text-left">‚û°Ô∏è Smƒõr</th>
                <th class="text-left">üöÜ Typ</th>
                <th class="text-left">üìè Vzd√°l.</th>
                <th class="text-left">‚è≥ ƒåas</th>
                <th class="text-left">üèÅ P≈ô√≠jezd</th>
                <th class="text-left">üéüÔ∏è Ticket</th>
              </tr>
            </thead>
            <tbody id="timetableBody" class="text-slate-200">
              <!-- dynamick√° data -->
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <div class="task-bar">
      <button id="taskCard" type="button" class="task-card task-card--intro-hidden">
        <div class="task-card__priority-dot hidden" id="currentTaskPriorityBadge" title="Vysok√°"></div>
        <p class="task-card__location" id="currentTaskLocation">-</p>
        <span class="task-card__reward-pill" id="currentTaskReward">0 XP</span>
        <p class="task-card__title" id="currentTaskTitle">≈Ω√°dn√© zad√°n√≠</p>
        <p class="task-card__summary" id="currentTaskSummary">
          Velitelstv√≠ zat√≠m neposlalo ≈æ√°dnou operaci. Sleduj kan√°l HQ.
        </p>
        <div class="task-card__progress">
          <span id="currentTaskProgressLabel">0%</span>
          <div class="task-card__progress-bar">
            <div id="currentTaskProgressBar" class="task-card__progress-bar-fill"></div>
          </div>
        </div>
      </button>
    </div>

    <div class="city-footer">
      <div class="location-bar">
        <div class="footer-content">
          <div class="location-grid">
            <button id="cityHubBtn" class="location-pill" data-label="√övod" aria-label="√övod">
              <svg class="location-pill__icon" viewBox="0 0 32 32" role="presentation">
                <path d="M6 14L16 6l10 8" />
                <path d="M8 14v12h6v-7h4v7h6V14" />
              </svg>
            </button>
            <button id="ticketToggleBtn" class="location-pill" data-label="N√°dra≈æ√≠" aria-label="N√°dra≈æ√≠">
              <svg class="location-pill__icon" viewBox="0 0 32 32" role="presentation">
                <path d="M8 10h16a2 2 0 0 1 2 2v9a3 3 0 0 1-3 3H9a3 3 0 0 1-3-3v-9a2 2 0 0 1 2-2z" />
                <path d="M8 16h16" />
                <circle cx="12" cy="19" r="1.4" />
                <circle cx="20" cy="19" r="1.4" />
                <path d="M12 24l-2 3m12-3l2 3" />
              </svg>
            </button>
            <button id="infoCenterBtn" class="location-pill" data-label="Infocentrum" aria-label="Informaƒçn√≠ centrum">
              <svg class="location-pill__icon" viewBox="0 0 32 32" role="presentation">
                <path d="M6 12h20l-10-6z" />
                <path d="M10 12v12m4-12v12m4-12v12m4-12v12" />
                <path d="M6 24h20" />
              </svg>
            </button>
            <button id="bankBtn" class="location-pill" data-label="Banka" aria-label="Banka">
              <svg class="location-pill__icon" viewBox="0 0 32 32" role="presentation">
                <rect x="6" y="10" width="20" height="12" rx="2" ry="2" />
                <path d="M6 15h20" />
                <circle cx="12" cy="21" r="2.2" />
                <path d="M18 20h5" />
              </svg>
            </button>
            <button id="labBtn" class="location-pill" data-label="Laborato≈ô" aria-label="Laborato≈ô">
              <svg class="location-pill__icon" viewBox="0 0 32 32" role="presentation">
                <path d="M12 6v7l-5 9a4 4 0 0 0 3.5 6h11a4 4 0 0 0 3.5-6l-5-9V6" />
                <path d="M12 13h8" />
                <path d="M10 22h12" />
                <circle cx="13" cy="19" r="1" />
                <circle cx="19" cy="20.5" r="1" />
              </svg>
            </button>
            <button id="workshopBtn" class="location-pill" data-label="D√≠lna" aria-label="D√≠lna">
              <svg class="location-pill__icon" viewBox="0 0 32 32" role="presentation">
                <path d="M9 12l5 5-2 2-5-5" />
                <path d="M20 8l4 4-7 7-4-4z" />
                <path d="M17 23l4 4" />
                <path d="M22 18l4 4" />
              </svg>
            </button>
            <button class="location-pill" data-label="Trh" aria-label="Trh">
              <svg class="location-pill__icon" viewBox="0 0 32 32" role="presentation">
                <path d="M7 12h18l-2 13H11L9 8H5" />
                <circle cx="14" cy="25" r="1.5" />
                <circle cx="22" cy="25" r="1.5" />
                <path d="M12 17h11" />
              </svg>
            </button>
            <button id="hqBtn" class="location-pill" data-label="HQ kan√°l" aria-label="HQ kan√°l">
              <svg class="location-pill__icon" viewBox="0 0 32 32" role="presentation">
                <circle cx="16" cy="16" r="8" />
                <path d="M8 16h16" />
                <path d="M16 8a20 20 0 0 1 0 16m0-16a20 20 0 0 0 0 16" />
              </svg>
            </button>
          </div>
          <div class="footer-resources">
            <div class="energy-meter">
              <div class="energy-meter__label">Energie</div>
              <div class="energy-meter__bar">
                <div id="agentEnergyBarFill" class="energy-meter__bar-fill"></div>
              </div>
              <div class="energy-meter__value" id="agentEnergyLabel">0 / 100</div>
            </div>
            <div class="resource-pill resource-pill--data">
              <span class="resource-pill__icon">üßÆ</span>
              <span class="resource-pill__value" id="agentDataLabel">0 / 100</span>
            </div>
            <div class="resource-pill resource-pill--material">
              <span class="resource-pill__icon">üß±</span>
              <span class="resource-pill__value" id="agentMaterialLabel">0 / 100</span>
            </div>
            <div class="resource-pill resource-pill--credits">
              <span class="resource-pill__icon">üí∞</span>
              <span class="resource-pill__value" id="agentCreditsLabel">0</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div id="teleportOverlay" class="teleport-overlay hidden">
      <div class="teleport-panel space-y-5">
        <div class="flex items-center justify-between gap-4">
          <div>
            <p class="text-[11px] uppercase tracking-[0.35em] text-slate-400">Testovac√≠ re≈æim</p>
            <h3 class="text-lg font-semibold text-slate-50">Simuluj p≈ôist√°n√≠ ve mƒõstƒõ</h3>
          </div>
          <button
            id="teleportOverlayClose"
            type="button"
            class="px-3 py-1.5 rounded-full border border-white/20 text-[10px] uppercase tracking-[0.3em] text-slate-100 hover:bg-white/10"
          >
            Zav≈ô√≠t
          </button>
        </div>
        <div>
          <label for="teleportCitySelect">Vyber mƒõsto</label>
          <select id="teleportCitySelect">
            <option value="">Naƒç√≠t√°m...</option>
          </select>
        </div>
        <div class="flex items-center justify-between gap-3">
          <p id="teleportStatus" class="text-xs text-slate-400 flex-1">
            P≈ôesun je okam≈æit√Ω, vyu≈æij jen pro testov√°n√≠.
          </p>
          <button
            id="teleportExecuteBtn"
            type="button"
            class="bg-white/10 text-slate-100 border border-white/15 hover:bg-white/20"
          >
            Teleportovat
          </button>
        </div>
      </div>
    </div>

    <div
      id="labStoryNotice"
      class="lab-story-overlay hidden"
      role="dialog"
      aria-modal="true"
      aria-labelledby="labStoryTitle"
    >
      <div class="lab-story-dialog space-y-6">
        <div class="lab-story-header">
          <div class="lab-story-figure">
            <div class="lab-story-portrait">
              <img src="/static/assets/dr_rook.png" alt="Dr. Elias Rook" />
            </div>
            <div class="lab-story-bubble">
              <p class="lab-story-eyebrow">Laboratorn√≠ briefing</p>
              <h4 id="labStoryTitle">-</h4>
              <p id="labStoryBody">-</p>
            </div>
          </div>
          <button id="labStoryClose" type="button" class="lab-story-close">Zav≈ô√≠t</button>
        </div>
        <div class="lab-story-meta">
          <div>
            <p class="text-sm text-slate-200 font-semibold">Dr. Elias Rook</p>
            <p class="text-xs text-slate-400">Vedouc√≠ biometrick√©ho programu</p>
          </div>
        </div>
        <div class="lab-story-actions justify-end">
          <button id="labStoryConfirm" type="button" class="lab-story-confirm">Dokonƒçit briefing</button>
        </div>
      </div>
    </div>

    <div
      id="travelOverlay"
      class="fixed inset-0 bg-slate-950/90 backdrop-blur hidden z-50 flex items-center justify-center px-4"
    >
      <div class="travel-card">
        <div class="travel-hero">
          <div class="travel-hero__train">
            <img id="travelTrainImg" src="/static/assets/train_1.png" alt="Train" />
          </div>
          <div class="travel-hero__info">
            <p class="travel-eyebrow">Aktu√°ln√≠ spoj</p>
            <div class="travel-line-stack">
              <span class="travel-line-chip" id="travelTopType">-</span>
              <span class="travel-line-chip border-sky-300/30 text-sky-100" id="travelTopSpeed">-</span>
            </div>
          </div>
        </div>

        <div class="travel-hero-divider"></div>

        <div class="travel-time">
          <strong id="travelClockLabel">-</strong>
        </div>

        <div class="travel-map-container">
          <div class="travel-map-frame relative">
            <canvas
              id="travelMapCanvas"
              width="640"
              height="340"
              class="travel-map-canvas"
              aria-label="Mapa cesty mezi mƒõsty"
            >
              Tvoje za≈ô√≠zen√≠ nepodporuje vykreslen√≠ mapy.
            </canvas>
          </div>
        </div>

        <div class="travel-stats-row">
          <div class="travel-stat-card">
            <span>Vzd√°lenost</span>
            <strong id="travelDistanceLabel">-</strong>
          </div>
          <div class="travel-stat-card">
            <span>ƒåas j√≠zdy</span>
            <strong id="travelDurationLabel">-</strong>
          </div>
        </div>
      </div>
    </div>

    <script type="module" src="{{ url_for('static', filename='js/game.js') }}"></script>
  </body>
</html>
      .travel-hero-divider {
        height: 1px;
        width: 100%;
        background: linear-gradient(90deg, rgba(148, 163, 184, 0.05), rgba(148, 163, 184, 0.35), rgba(148, 163, 184, 0.05));
        margin-top: 0.6rem;
      }
